(()=>{"use strict";var t,e,r={628:(t,e,r)=>{new EventTarget;function n(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}var i=function(t,e,r){return t.gis_data[e].features[r].properties},o=function(t,e,r){return t.gis_data[e].features[r].geometry},a=function(t,e,r){for(var n=t.gis_data[e],i=[],o=0;o<n.features.length;o++){for(var a=n.features[o].properties,s=Object.keys(r),l=!0,h=0;h<s.length;h++){var d=s[h],u=r[d];if(a[d]!=u){l=!1;break}}l&&i.push(o)}return i};const s=function(){var t=this;this.generate=function(e){return t.generateComment()+" "+t.generateStartTag()+" "+t.generateElementTag()+" "+t.generateChildren(e)+" "+t.generateEndTag()+" "},this.pushSvgCommand=function(e,r,n){var i={command:e,x:String(r),y:String(n)};t.svg_command.push(i)},this.setTag=function(e){t.tag=e},this.setElement=function(e){t.element=e},this.linkChild=function(e){t.children.push(e)},this.pushAttribute=function(e,r){t.attributes[e]=r},this.pushComment=function(e){t.svg_comment.push(e)},this.pushAttributeNum=function(e,r){t.attributes[e]=r.toString()},this.generateSvgCommand=function(){if(0==t.svg_command.length)return"";var e="";e+='d="';for(var r=0;r<t.svg_command.length;r++){var n=t.svg_command[r],i=" ";i+=n.command,"none"!=n.x&&(i+=" ",i+=n.x),"none"!=n.y&&(i+=" ",i+=n.y),e+=i}return e+='"'},this.generateStartTag=function(){return"<"+t.tag+" "+t.generateAttributeTag()+" "+t.generateSvgCommand()+" >"},this.generateElementTag=function(){return t.element},this.generateEndTag=function(){return"</"+t.tag+">"},this.generateComment=function(){for(var e="",r=0;r<t.svg_comment.length;r++)e+="\x3c!--"+t.svg_comment[r]+"--\x3e\n";return e},this.generateChildren=function(e){for(var r=" ",n=0;n<t.children.length;n++)r+=e[t.children[n]].generate(e),r+=" ";return r},this.generateAttributeTag=function(){for(var e="",r=Object.keys(t.attributes),n=0;n<r.length;n++){var i=r[n];e+=" "+i+' = "'+t.attributes[i]+'" '}return e},this.tag="",this.children=[],this.element="",this.attributes={},this.svg_command=[],this.svg_comment=[]};var l=function(t,e,r){var n=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/(d(t,e)*d(t,r));return Math.acos(n)},h=function(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.pow(r,2)+Math.pow(n,2)},d=function(t,e){var r=e.x-t.x,n=e.y-t.y,i=Math.pow(r,2)+Math.pow(n,2);return Math.sqrt(i)},u=l({x:0,y:0},{x:1,y:0},{x:0,y:1}),c=function(t){return Object.assign(Object.create(Object.getPrototypeOf(t)),t)},f=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},p=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};const g=function(){var t=this;this.pushNode=function(e){if(t.graph.has(e.node_id)){for(var r=t.graph.get(e.node_id),n=0;n<e.bidirectional_link_id_list.length;n++){var i=e.bidirectional_link_id_list[n];r.pushBidirectionalLinkNode(i)}t.graph.set(e.node_id,r)}else t.graph.set(e.node_id,e);for(n=0;n<e.bidirectional_link_id_list.length;n++){var o=e.bidirectional_link_id_list[n],a=t.graph.get(o);a.pushBidirectionalLinkNode(e.node_id),t.graph.set(o,a)}},this.getTerminationPointID=function(){if(0==t.graph.size)return[];for(var e=[],r=1;0==e.length;)e=t.getPointID(r),r++;return e},this.getOddBranchPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),i=0;i<n.length;i++){var o=n[i],a=t.graph.get(o);a.bidirectional_link_id_list.length%2==1&&a.bidirectional_link_id_list.length>=3&&e.push(o)}return e},this.getEvenBranchPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),i=0;i<n.length;i++){var o=n[i],a=t.graph.get(o);a.bidirectional_link_id_list.length%2==0&&a.bidirectional_link_id_list.length>=4&&e.push(o)}return e},this.getOddPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),i=0;i<n.length;i++){var o=n[i];t.graph.get(o).bidirectional_link_id_list.length%2!=1||e.push(o)}return e},this.getEvenPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),i=0;i<n.length;i++){var o=n[i];t.graph.get(o).bidirectional_link_id_list.length%2!=0||e.push(o)}return e},this.getPointID=function(e){for(var r=[],n=t.graph.keys(),i=Array.from(n),o=0;o<i.length;o++){var a=i[o];t.graph.get(a).bidirectional_link_id_list.length!=e||r.push(a)}return r},this.deleteLinkNode=function(e,r){var n=t.graph.get(e);n.bidirectional_link_id_list=n.bidirectional_link_id_list.filter((function(t,e){return t!=r}))},this.replaceLinkNode=function(e,r,n){for(var i=t.graph.get(e),o=0;o<i.bidirectional_link_id_list.length;o++)i.bidirectional_link_id_list[o]==r&&(i.bidirectional_link_id_list[o]=n)},this.separationLinkNode=function(e,r,n){var i=t.graph.get(e),o=i.copyGraphNode(),a=i.copyGraphNode();o.bidirectional_link_id_list=p([],f(r),!1),a.bidirectional_link_id_list=i.bidirectional_link_id_list.filter((function(t){return!r.includes(t)}));var s=i.node_id,l=s+n;o.node_id=l,t.graph.set(o.node_id,o),t.graph.set(a.node_id,a);for(var h=0;h<r.length;h++)t.replaceLinkNode(r[h],s,l);return l},this.intersectionExtraction=function(){for(var e=[],r=function(e){for(var r=t.graph.get(e),n=r.bidirectional_link_id_list,i=Number.MIN_SAFE_INTEGER,o=[],a=0;a<n.length;a++)for(var s=n[a],h=t.graph.get(s),d=a+1;d<n.length;d++){var u=n[d],c=t.graph.get(u),f=l({x:r.x,y:r.y},{x:h.x,y:h.y},{x:c.x,y:c.y});i<f&&(i=f,o=[s,u])}return o},n=function(e,r){var n=t.graph.get(e),i=n.bidirectional_link_id_list.filter((function(t,e){return!r.includes(t)}));if(2!=i.length)return!1;var o=t.graph.get(i[0]),a=t.graph.get(i[1]);return l({x:n.x,y:n.y},{x:o.x,y:o.y},{x:a.x,y:a.y})<=u},i=t.getEvenBranchPointID(),o=0;i.length>0;){var a=i[0],s=r(a);n(a,s)?e.push(a):t.separationLinkNode(a,s,"s"+o),o++,i=t.getEvenBranchPointID().filter((function(t,r){return!e.includes(t)}))}},this.loopLinePoint=function(e,r){var n=r[0],i=t.graph.get(n),o=c(i),a=c(i);o.bidirectional_link_id_list=[i.bidirectional_link_id_list[0]],a.bidirectional_link_id_list=[i.bidirectional_link_id_list[1]];var s=a.node_id,l=s+"c";a.node_id=l,t.graph.set(o.node_id,o),t.graph.set(a.node_id,a),t.replaceLinkNode(i.bidirectional_link_id_list[1],s,l)},this.graph=new Map};var v=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},_=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};const y=function t(){var e=this;this.copyGraphNode=function(){var r=new t;return r.x=e.x,r.y=e.y,r.node_id=e.node_id,r.bidirectional_link_id_list=_([],v(e.bidirectional_link_id_list),!1),r},this.pushBidirectionalLinkNode=function(t){e.bidirectional_link_id_list.push(t)},this.setId=function(t){e.node_id=t},this.setIdByPos=function(t,r){var n=t+"p"+r;e.node_id=n},this.setX=function(t){e.x=t},this.setY=function(t){e.y=t},this.setPos=function(t,r){e.x=t,e.y=r},this.getPos=function(){return{x:e.x,y:e.y}},this.node_id="",this.x=0,this.y=0,this.bidirectional_link_id_list=[]};var m=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const x=function(){var t=this;this.getPaths=function(e){return t.node_paths.has(e)?t.node_paths.get(e):[]},this.isValidNode=function(e){var r,n;if(!t.node_paths.has(e))return!1;var i=t.node_paths.get(e);try{for(var o=m(i),a=o.next();!a.done;a=o.next())if(a.value>=0)return!0}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},this.otheGroupPath=function(e,r){var n,i,o,a;if(!t.node_paths.has(e))return-1;if(!t.node_paths.has(r))return-1;var s=t.node_paths.get(e),l=t.node_paths.get(r);try{for(var h=m(s),d=h.next();!d.done;d=h.next()){var u=d.value;try{for(var c=(o=void 0,m(l)),f=c.next();!f.done;f=c.next())if(u==f.value)return u}catch(t){o={error:t}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}}}catch(t){n={error:t}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}return-1},this.pushNode=function(e,r){if(t.node_paths.has(e)){var n=t.node_paths.get(e);n.push(r),t.node_paths.set(e,n)}else t.node_paths.set(e,[r])},this.node_paths=new Map};var b=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},w=function(){var t=this;this.pushArrivedNode=function(e){t.arrived_nodes.push(e)},this.isArrivedNode=function(e){return t.arrived_nodes.includes(e)},this.includeArrivedNode=function(e){var r=[];r=(r=r.concat(t.arrived_nodes)).concat(e.arrived_nodes),t.arrived_nodes=r},this.setCoordinateExpressionId=function(e){t.coordinate_expression_id=e},this.getCoordinateExpressionId=function(){return t.coordinate_expression_id},this.hasCoordinateExpressionId=function(){return t.coordinate_expression_id>=0},this.includeRoute=function(e){var r=[];r=(r=r.concat(t.routes)).concat(e.routes),t.routes=r},this.replaceRoute=function(e){t.routes=[],t.routes=t.routes.concat(e)},this.pushRoute=function(e){t.routes.push(e)},this.pushRoutes=function(e){var r,n;try{for(var i=b(e),o=i.next();!o.done;o=i.next()){var a=o.value;t.routes.push(a)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},this.setDistance=function(e){t.distance=e},this.distance=-1,this.routes=[],this.coordinate_expression_id=-1,this.arrived_nodes=[]};const k=w;var N=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const P=function(){var t=this;this.getOddBranch=function(){var e,r,n=[];try{for(var i=N(t.route.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;t.route.get(a).size%2==1&&n.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},this.getBranch=function(e){var r,n,i=[];try{for(var o=N(t.route.keys()),a=o.next();!a.done;a=o.next()){var s=a.value;t.route.get(s).size==e&&i.push(s)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},this.getTerminal=function(){var e,r,n=[];try{for(var i=N(t.route.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;1==t.route.get(a).size&&n.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},this.getBranchNodes=function(){var e,r,n=[];try{for(var i=N(t.route.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;t.route.get(a).size>=3&&n.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},this.getNodeKeys=function(){return t.route.keys()},this.getNodeKeysList=function(){return Array.from(t.route.keys())},this.getPathContacts=function(e,r){if(!t.route.has(e))return[];var n=t.route.get(e);return n.has(r)?n.get(r):[]},this.hasPathContact=function(e,r){if(!t.route.has(e))return!1;var n=t.route.get(e);return!!n.has(r)&&0!=n.get(r).length},this.getSortPathContact=function(e,r,n){if(!t.route.has(r))return[];var i,o,a=t.route.get(r);if(!a.has(n))return[];var s=a.get(n);return e?(i=-1,o=1):(i=1,o=-1),s.sort((function(t,e){var r=t,n=e;return r.distance>n.distance?i:r.distance<n.distance?o:0})),s},this.getAllSortPathContact=function(e){var r,n,i=t.getAllPathContact();return e?(r=-1,n=1):(r=1,n=-1),i.sort((function(t,e){var i=t,o=e;return i.distance>o.distance?r:i.distance<o.distance?n:0})),i},this.getAllPathContact=function(){var e,r,n,i,o=[];try{for(var a=N(t.route.keys()),s=a.next();!s.done;s=a.next()){var l=s.value,h=t.route.get(l);try{for(var d=(n=void 0,N(h.keys())),u=d.next();!u.done;u=d.next()){var c=u.value,f=h.get(c);o=o.concat(f)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o},this.getPathContact=function(e,r){return t.route.get(e).get(r)[0]},this.getMinPathContact=function(e,r){for(var n,i=t.route.get(e).get(r),o=Number.MAX_SAFE_INTEGER,a=0;a<i.length;a++)o>i[a].distance&&(n=i[a]);return n},this.buildNextPaths=function(e){var r,n,i,o;try{for(var a=N(e),s=a.next();!s.done;s=a.next()){var l=s.value,h=new Map;try{for(var d=(i=void 0,N(e)),u=d.next();!u.done;u=d.next()){var c=u.value;l!=c&&h.set(c,[])}}catch(t){i={error:t}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}t.route.set(l,h)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},this.buildPaths=function(e){for(var r=e.length,n=0;n<r;n++){for(var i=e[n],o=new Map,a=0;a<r;a++){var s=e[a];if(n!=a)o.set(s,[]);else{var l=new k;l.setDistance(-1),l.coordinate_expression_id=-2,o.set(s,[l])}}t.route.set(i,o)}},this.setSemiRoute=function(e,r,n){if(!t.route.has(e)){var i=new Map;t.route.set(e,i)}var o=t.route.get(e),a=[n];o.set(r,a),t.route.set(e,o)},this.pushSemiRoute=function(e,r,n){if(!t.route.has(e)){var i=new Map;t.route.set(e,i)}var o=t.route.get(e);o.has(r)||o.set(r,[]);var a=o.get(r);a.push(n),o.set(r,a),t.route.set(e,o)},this.pushRoute=function(e,r,n){if(!t.route.has(e)){var i=new Map;t.route.set(e,i)}t.route.has(r)||(i=new Map,t.route.set(r,i));var o=t.route.get(e),a=t.route.get(r);if(!o.has(r)){var s=[];o.set(r,s)}a.has(e)||(s=[],a.set(e,s));var l=o.get(r),h=a.get(e);l.push(n),h.push(n),o.set(r,l),a.set(e,h),t.route.set(e,o),t.route.set(r,a)},this.pushRoutes=function(e,r,n){var i,o;try{for(var a=N(n),s=a.next();!s.done;s=a.next()){var l=s.value;t.pushRoute(e,r,l)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}},this.route=new Map};var S=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const C=function(){var t=this;this.generateNext=function(t){var e,r,n=new P;try{for(var i=S(t.path.values()),o=i.next();!o.done;o=i.next()){var a=o.value,s=a.getDistance(),l=a.getFirstNodeId(),h=a.getLastNodeId(),d=new k;d.setDistance(s),d.pushRoute(a.coordinate_expression_id),d.setCoordinateExpressionId(a.coordinate_expression_id),n.pushRoute(l,h,d)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},this.generateRouteHalf=function(e,r,n){var i=new P;return i=t.extractionEnumeration(e,r,i,n)},this.generateRoute=function(e,r){var n,i,o=new P;try{for(var a=S(e.graph.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;o=t.extractionEnumeration(e,r,o,l)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},this.generateRouteShortest=function(e,r){var n,i,o=new P;try{for(var a=S(e.graph.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;o=t.extractionGraphDetermination(e,r,o,l)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},this.generateGraphExtraction=function(t,e){var r,n,i=new g;try{for(var o=S(e.path.values()),a=o.next();!a.done;a=o.next()){var s=a.value,l=(s.getDistance(),s.getFirstNodeId()),h=s.getLastNodeId(),d=t.graph.get(l),u=t.graph.get(h),c=new y;c.setPos(d.x,d.y),c.setId(l),i.pushNode(c);var f=new y;f.setPos(u.x,u.y),f.setId(h),f.pushBidirectionalLinkNode(l),i.pushNode(f)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},this.extractionGraphDetermination=function(t,e,r,n){var i,o,a,s,l,h=[],d=new Map,u=function(t){return h.push(t)-1};u(n);try{for(var c=S(t.graph.keys()),f=c.next();!f.done;f=c.next()){var p=f.value;d.set(p,Number.MAX_SAFE_INTEGER)}}catch(t){i={error:t}}finally{try{f&&!f.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}for(d.set(n,0);h.length>0;){var g=(l=void 0,l=h[0],h.shift(),l),v=t.graph.get(g).bidirectional_link_id_list;try{for(var _=(a=void 0,S(v)),y=_.next();!y.done;y=_.next()){var m=y.value;if(g!=m&&n!=m){var x=e.getMinPathContact(g,m),b=x.distance+d.get(g),w=d.get(m);if(!(w<=b)){w>b&&(d.set(m,b),u(m));var N=new k;if(N.setDistance(b),N.setCoordinateExpressionId(-3),r.hasPathContact(n,g)){var P=r.getMinPathContact(n,g);N.includeRoute(P)}N.pushRoute(x.coordinate_expression_id),r.setSemiRoute(n,m,N)}}}}catch(t){a={error:t}}finally{try{y&&!y.done&&(s=_.return)&&s.call(_)}finally{if(a)throw a.error}}}return r},this.extractionEnumeration=function(t,e,r,n){var i=function(o,a,s){var l,h,d,u,c,f,p,g,v=o[o.length-1],_=t.graph.get(v).bidirectional_link_id_list;if(o.length<2)try{for(var y=S(_),m=y.next();!m.done;m=y.next()){var x=m.value,b=e.getPathContacts(v,x);try{for(var w=(d=void 0,S(b)),N=w.next();!N.done;N=w.next()){var P=N.value;(j=o).push(x),(R=a).push(P.coordinate_expression_id),i(j,R,P.distance),j.pop(),R.pop()}}catch(t){d={error:t}}finally{try{N&&!N.done&&(u=w.return)&&u.call(w)}finally{if(d)throw d.error}}}}catch(t){l={error:t}}finally{try{m&&!m.done&&(h=y.return)&&h.call(y)}finally{if(l)throw l.error}}else{o[o.length-2];var C=new k;C.setCoordinateExpressionId(-3),C.setDistance(s),C.pushRoutes(a),r.pushSemiRoute(n,v,C);try{for(var I=S(_),A=I.next();!A.done;A=I.next()){x=A.value;var E=e.getPathContacts(v,x);try{for(var O=(p=void 0,S(E)),L=O.next();!L.done;L=O.next()){var T=L.value;if(!a.includes(T.coordinate_expression_id)){var j,R;(j=o).push(x),(R=a).push(T.coordinate_expression_id);var M=s+T.distance;i(j,R,M),j.pop(),R.pop()}}}catch(t){p={error:t}}finally{try{L&&!L.done&&(g=O.return)&&g.call(O)}finally{if(p)throw p.error}}}}catch(t){c={error:t}}finally{try{A&&!A.done&&(f=I.return)&&f.call(I)}finally{if(c)throw c.error}}}};return i([n],[],0),r}};var I=r(543),A=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const E=function t(e,r){void 0===r&&(r="unknown");var n=this;this.includePathOrder=function(t,e){I.cloneDeep(n.pos_order);var r,i,o=t.pos_order.filter((function(t,r){return r>=e}));n.pos_order=n.pos_order.concat(o);try{for(var a=A(t.coordinates.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;n.coordinates.set(l,t.coordinates.get(l))}}catch(t){r={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},this.includePath=function(t){var e,r;n.pos_order=n.pos_order.concat(t.pos_order),n.coordinate_name=t.coordinate_name;try{for(var i=A(t.coordinates.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;n.coordinates.set(a,t.coordinates.get(a))}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}},this.setCoordinateExpressionId=function(t){n.coordinate_expression_id=t},this.reversePosOrder=function(){n.pos_order=n.pos_order.reverse()},this.getDistance=function(){for(var t=0,e=1;e<n.pos_order.length;e++){var r=n.coordinates.get(n.pos_order[e-1]),i=n.coordinates.get(n.pos_order[e]);t+=d(r,i)}return t},this.getFirstNodeId=function(){return n.pos_order[0]},this.getLastNodeId=function(){return n.pos_order[n.pos_order.length-1]},this.pushDebugMessage=function(t,e){n.debug_message.push(t+" x:"+String(e.x)+" y: "+String(e.y))},this.getType=function(){return n.type},this.pushPosIdsIndex=function(t,e){n.pos_order.splice(e,0,t)},this.pushPosIds=function(t){n.pos_order.push(t)},this.pushCoordinateId=function(t,e,r){n.coordinates.set(t,{x:e,y:r}),n.pushPosIds(t)},this.getAverage=function(){for(var e=0,r=0,i=0,o=0;o<n.pos_order.length;o++){var a=n.pos_order[o],s=n.coordinates.get(a);e+=s.x,r+=s.y,i++}var l=e/i,h=r/i,d=new t("point",n.coordinate_name);return d.pushCoordinateId(String(l)+"p"+String(h),l,h),d},this.coordinates=new Map,this.coordinate_name=r,this.type=e,this.debug_message=[],this.pos_order=[]};const O=function(){var t=this;this.getJoinPathCoordinateFlag=function(t,e){if(t.length<2)return[-1,-1];if(e.length<2)return[-1,-1];var r=function(){return t[0]},n=function(){return t[t.length-1]},i=function(){return e[0]},o=function(){return e[e.length-1]};return n()==i()?[0,0]:n()==o()?[0,1]:r()==i()?[1,0]:r()==o()?[1,1]:[-1,-1]},this.getJoinPathFlag=function(e,r){var n=t.path.get(e),i=t.path.get(r);return n.getLastNodeId()==i.getFirstNodeId()?[0,0]:n.getLastNodeId()==i.getLastNodeId()?[0,1]:n.getFirstNodeId()==i.getFirstNodeId()?[1,0]:n.getFirstNodeId()==i.getLastNodeId()?[1,1]:[-1,-1]},this.joinPath=function(e,r){var n=t.path.get(e),i=t.path.get(r);if(n.getLastNodeId()==i.getFirstNodeId());else if(n.getLastNodeId()==i.getLastNodeId())i.reversePosOrder();else if(n.getFirstNodeId()==i.getFirstNodeId())n.reversePosOrder();else{if(n.getFirstNodeId()!=i.getLastNodeId())return!1;n.reversePosOrder(),i.reversePosOrder()}return n.includePathOrder(i,0),t.path.delete(i.coordinate_expression_id),t.path.set(n.coordinate_expression_id,n),!0},this.isAdjoinProcessed=function(e,r,n){for(var i=t.path.get(e),o=-100,a=-102,s=0;s<i.pos_order.length;s++)r==i.pos_order[s]&&(o=s),n==i.pos_order[s]&&(a=s);return 1==Math.abs(o-a)},this.pushProcessed=function(){var e=new E("path"),r=t.path.size;return e.setCoordinateExpressionId(r),t.path.set(r,e),r},this.pushProcessedPos=function(e,r,n){var i=t.pushProcessed(),o=t.path.get(i);return o.pushCoordinateId(e,r,n),t.path.set(i,o),i},this.pushCoordinateId=function(e,r,n,i){var o=t.path.get(e);o.pushCoordinateId(r,n,i),t.path.set(e,o)},this.path=new Map};var L=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},T=function(t,e){var r=this;this.getProcessedPath=function(){return r.processed_path},this.debugNode=function(){var t,e,n=r.graph_container.graph.keys();try{for(var i=L(n),o=i.next();!o.done;o=i.next())for(var a=o.value,s=r.graph_container.graph.get(a),l=0;l<s.bidirectional_link_id_list.length;l++){var h=s.bidirectional_link_id_list[l];r.graph_container.graph.get(h),r.processed_path.pushProcessed()}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},this.startCalc=function(){r.graph_container.intersectionExtraction(),r.graph_container.graph.keys();var t=r.graph_container.getPointID(1),e=r.graph_container.getPointID(2);0==t.length&&e.length>0&&r.graph_container.loopLinePoint(t,e),r.calcTerminationPoint(),r.original_data_coordinate_correction_flag&&r.reliefSeparate()>0&&(r.node_path=new x,r.processed_path=new O,r.bfs_que=[],r.calcTerminationPoint());for(var n=new C,i=n.generateGraphExtraction(r.graph_container,r.processed_path),o=function(){return i.getPointID(2).filter((function(t,e){return i.graph.get(t).bidirectional_link_id_list[0]==i.graph.get(t).bidirectional_link_id_list[1]}))},a=o();a.length>0;){var s=a[0],l=i.graph.get(s).bidirectional_link_id_list[0],h=(r.graph_container.graph.get(s),r.graph_container.graph.get(l).copyGraphNode()),d=h.node_id+"d";h.node_id=d,h.bidirectional_link_id_list=[s],r.graph_container.graph.set(d,h),r.graph_container.deleteLinkNode(l,s),r.graph_container.replaceLinkNode(s,l,d),r.calcReStart(),i=n.generateGraphExtraction(r.graph_container,r.processed_path),a=o()}},this.calcReStart=function(){r.node_path=new x,r.processed_path=new O,r.bfs_que=[],r.calcTerminationPoint()},this.calcTerminationPoint=function(){for(var t=r.graph_container.getTerminationPointID(),e=0;e<t.length;e++){var n=t[e],i=r.graph_container.graph.get(n);if(!r.isValidNodePath(n)){var o=r.processed_path.pushProcessedPos(n,i.x,i.y);r.node_path.pushNode(n,o),r.dfs(n)}}},this.popDfsStack=function(){var t=r.bfs_que[r.bfs_que.length-1];return r.bfs_que.pop(),t},this.isValidNodePath=function(t){return r.node_path.isValidNode(t)},this.dfs=function(t){var e,n,i,o;r.bfs_que=[],r.bfs_que.push(t);var a=r.graph_container.graph.get(t),s=r.node_path.getPaths(t);try{for(var l=L(s),h=l.next();!h.done;h=l.next()){var d=h.value;r.processed_path.pushCoordinateId(d,t,a.x,a.y)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}for(;r.bfs_que.length>0;){r.bfs_que.length;for(var u=r.popDfsStack(),c=r.graph_container.graph.get(u),f=c.bidirectional_link_id_list,p=f.length,g=r.node_path.getPaths(u),v=0;v<p;v++){var _=f[v],y=r.graph_container.graph.get(_);if(!(r.node_path.otheGroupPath(u,_)>=0)){if(p>=3){var m=r.processed_path.pushProcessedPos(u,c.x,c.y);r.processed_path.pushCoordinateId(m,_,y.x,y.y),r.node_path.pushNode(u,m),r.node_path.pushNode(_,m)}else try{for(var x=(i=void 0,L(g)),b=x.next();!b.done;b=x.next()){var w=b.value;r.processed_path.pushCoordinateId(w,_,y.x,y.y),r.node_path.pushNode(_,w)}}catch(t){i={error:t}}finally{try{b&&!b.done&&(o=x.return)&&o.call(x)}finally{if(i)throw i.error}}r.bfs_que.push(_)}}}},this.reliefSeparateTerminalPoint=function(t){var e,n,i,o,a,s=0,l=r.graph_container.graph.get(t);try{for(var d=L(r.processed_path.path.values()),u=d.next();!u.done;u=d.next()){var f=u.value;if(!f.coordinates.has(t))for(var p=2;p<f.pos_order.length-1;p++){var g=f.pos_order[p-1],v=f.pos_order[p],_=f.coordinates.get(g),y=f.coordinates.get(v),m=h(_,y);if(h(_,{x:l.x,y:l.y})<=m){c(r.graph_container.graph.get(t)),l.bidirectional_link_id_list.includes(g)||l.bidirectional_link_id_list.push(g),l.bidirectional_link_id_list.includes(v)||l.bidirectional_link_id_list.push(v);var x=(i=l.getPos(),o=_,a=y,{x:(i.x+o.x+a.x)/3,y:(i.y+o.y+a.y)/3});return l.setPos(x.x,x.y),r.graph_container.replaceLinkNode(g,v,t),r.graph_container.replaceLinkNode(v,g,t),++s}}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(e)throw e.error}}return s},this.reliefSeparate=function(){var t,e,n=r.graph_container.getPointID(1),i=0;try{for(var o=L(n),a=o.next();!a.done;a=o.next()){var s=a.value;i+=r.reliefSeparateTerminalPoint(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return i},this.graph_container=t,this.node_path=new x,this.processed_path=new O,this.bfs_que=[],this.original_data_coordinate_correction_flag=e};const j=T;var R=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},M=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},D=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},F=function(){this.getJoinCoordinate=function(t,e){var r,n,i,o;if(0==t.length)return{order:[],coordinates:new Map,joint_index:[]};var a=[],s=new Map,l=[],h=e.path.get(t[0]);a=a.concat(h.pos_order);try{for(var d=R(h.coordinates.keys()),u=d.next();!u.done;u=d.next()){var c=u.value;s.set(c,h.coordinates.get(c))}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}for(var f=1;f<t.length;f++){var p=t[f],g=e.path.get(p),v=D([],M(g.pos_order),!1),_=e.getJoinPathCoordinateFlag(a,v);1==_[0]&&(a=a.reverse()),1==_[1]&&(v=v.reverse());var y=v.filter((function(t,e){return e>0}));l.push(a.length-1),a=a.concat(y);try{for(var m=(i=void 0,R(g.coordinates.keys())),x=m.next();!x.done;x=m.next())c=x.value,s.set(c,g.coordinates.get(c))}catch(t){i={error:t}}finally{try{x&&!x.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}}return{order:a,coordinates:s,joint_index:l}},this.joinLong=function(t){var e,r,n,i=[],o=[],a=function(t){var e,r;try{for(var n=R(t),i=n.next();!i.done;i=n.next()){var a=i.value;if(o.includes(a))return!0}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return!1},s=t.getAllSortPathContact(!0);if(0==s.length)return[];try{for(var l=R(s),h=l.next();!h.done;h=l.next()){var d=h.value;a(d.routes)||(n=d.routes,o=o.concat(n),i.push(d.routes))}}catch(t){e={error:t}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return i},this.joinContinuity=function(t,e){var r,n;try{for(var i=R(t),o=i.next();!o.done;o=i.next())for(var a=o.value,s=a[0],l=1;l<a.length;l++){var h=a[l];e.joinPath(s,h)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return e}};const G=F;const B=function(){var t=this;this.processSharpAngleRemoval=function(t){for(var e=0;e<t.joint_index.length;e++){var r=t.joint_index[e],n=t.order[r-1],i=t.order[r],o=t.order[r+1],a=t.coordinates.get(n),s=t.coordinates.get(i),h=t.coordinates.get(o);if(l(s,a,h)<u)return!0}return!1},this.hasProcessSharpAngleRemovalPath=function(e,r){var n=(new G).getJoinCoordinate(e,r);return t.processSharpAngleRemoval(n)}};var q=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const z=function(t,e){var r=this;this.checkDistance=function(t,e){return r.long?t>e:t<e},this.extractionDetermination=function(t,e,n,i,o){var a=null,s=null,l=function(t){return 1e8*t[0]+1e4*t[1]+t[2]},h=function(t){if(t.length<3)return!1;var e=[t[t.length-3],t[t.length-2],t[t.length-1]];if(function(t){return r.sharp_angle_cash.has(l(t))}(e))return function(t){return r.sharp_angle_cash.get(l(t))}(e);var i=(new B).hasProcessSharpAngleRemovalPath(e,n);return function(t,e){r.sharp_angle_cash.set(l(t),e)}(e,i),i},d=function(n,i,l,u){var c,f,p,g,v,_,y,m,x=n[n.length-1],b=t.graph.get(x).bidirectional_link_id_list;if(n.length<2)try{for(var w=q(b),N=w.next();!N.done;N=w.next()){var P=N.value,S=e.getPathContacts(x,P);try{for(var C=(p=void 0,q(S)),I=C.next();!I.done;I=C.next()){var A=I.value;(D=n).push(P),(F=i).push(A.coordinate_expression_id),d(D,F,A.distance,u),D.pop(),F.pop()}}catch(t){p={error:t}}finally{try{I&&!I.done&&(g=C.return)&&g.call(C)}finally{if(p)throw p.error}}}}catch(t){c={error:t}}finally{try{N&&!N.done&&(f=w.return)&&f.call(w)}finally{if(c)throw c.error}}else{var E;if(o==x)if((null==a||r.checkDistance(l,a.distance))&&((E=new k).setCoordinateExpressionId(-3),E.setDistance(l),E.pushRoutes(i),a=E),u&&(h(i)?u=!1:(null==s||r.checkDistance(l,s.distance))&&((E=new k).setCoordinateExpressionId(-3),E.setDistance(l),E.pushRoutes(i),s=E)),!r.long)return;if(o!=x&&u&&h(i)&&(u=!1),!(n.filter((function(t,e){return t==n[n.length-1]&&e<n.length-1})).length>0))try{for(var O=q(b),L=O.next();!L.done;L=O.next()){P=L.value;var T=e.getPathContacts(x,P);try{for(var j=(y=void 0,q(T)),R=j.next();!R.done;R=j.next()){var M=R.value;if(!i.includes(M.coordinate_expression_id)){var D,F;(D=n).push(P),(F=i).push(M.coordinate_expression_id);var G=l+M.distance;d(D,F,G,u),D.pop(),F.pop()}}}catch(t){y={error:t}}finally{try{R&&!R.done&&(m=j.return)&&m.call(j)}finally{if(y)throw y.error}}}}catch(t){v={error:t}}finally{try{L&&!L.done&&(_=O.return)&&_.call(O)}finally{if(v)throw v.error}}}};return d([i],[],0,r.sharp_angle_removal_flag),r.sharp_angle_removal_flag&&null!=s?s:a},this.searchDeleteClosedPathShort=function(t,e,n,i){for(var o=(new C).generateRouteShortest(n,i),a=[],s=0;s<t.length;s++){for(var l=t[s],h=s+1;h<t.length;h++){var d=t[h];if(o.hasPathContact(l,d)){var u=o.getMinPathContact(l,d);null!=u&&a.push(u)}}r.keep_paths=r.keep_paths.concat(a)}},this.searchDeleteClosedPathLong=function(t,e,n,i){for(var o=[],a=0;a<t.length;a++){for(var s=t[a],l=a+1;l<t.length;l++){var h=t[l],d=r.extractionDetermination(n,i,e,s,h);null!=d&&o.push(d)}r.keep_paths=r.keep_paths.concat(o)}},this.searchDeleteClosedPath=function(t,e,n,i){r.long?r.searchDeleteClosedPathLong(t,e,n,i):r.searchDeleteClosedPathShort(t,e,n,i)},this.deleteClosedPath=function(t){var e,n,i=function(){var t,e,n=[];try{for(var i=q(r.keep_paths),o=i.next();!o.done;o=i.next()){var a=o.value;n=n.concat(a.routes)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return n}();try{for(var o=q(t.path.values()),a=o.next();!a.done;a=o.next()){var s=a.value;i.includes(s.coordinate_expression_id)||t.path.delete(s.coordinate_expression_id)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return t},this.keep_paths=[],this.sharp_angle_removal_flag=t,this.long=e,this.sharp_angle_cash=new Map};var V=r(346),J=new V.A(1e5),X=new V.A(.010966404715491394),$=new V.A(X).times(J),K=new V.A(.0090133729745762),H=(K.times(J).div($),function(t,e,r,n,i){var l=this;this.pathOptimizeLoop=function(t,e,r,n){var i=new C,o=i.generateNext(r);i=null;var a=!1;2==t&&(a=!0);var s=new z(e,a),l=o.getBranch(1),h=1==l.length,d=h?o.getOddBranch():l;return s.searchDeleteClosedPath(d,r,n,o),r=s.deleteClosedPath(r),o=null,s=null,{branch1_flag:h,grah_paths:r}},this.pathOptimize=function(t,e,r,n){for(var i=10;i>0;){var o=l.pathOptimizeLoop(t,e,r,n);r=o.grah_paths,o.branch1_flag?i--:i=-1}return r},this.pathJoin=function(t,e){var r=new G,n=new C,i=n.generateNext(t),o=n.generateRoute(e,i),a=r.joinLong(o);return t=r.joinContinuity(a,t),r=null,n=null,i=null,o=null,a=null,t},this.generatePath=function(){var t=l.edit_data.layers[l.layer_uuid],e="ok"==t.layer_infomation.path_optimize,r="ok"==t.layer_infomation.path_join,n="ok"==t.layer_infomation.sharp_angle_removal,i="ok"==t.layer_infomation.original_data_coordinate_correction,o=Number(t.layer_infomation.path_optimize_closed_type),a=new j(l.graph,i);a.startCalc();var s=a.getProcessedPath(),h=(new C).generateGraphExtraction(l.graph,s);return e&&(s=l.pathOptimize(o,n,s,h)),r&&(s=l.pathJoin(s,h)),Array.from(s.path.values())},this.coordinateAggregation=function(){for(var t=l.edit_data.layers[l.layer_uuid],e=a(l.gis_info,l.unit_id,{N02_004:t.layer_infomation.railway,N02_003:t.layer_infomation.line}),r=0;r<e.length;r++){var n=o(l.gis_info,l.unit_id,e[r]).coordinates;l.parseCoordinatesToGraph(n)}},this.parseCoordinatesToGraph=function(t){for(var e="",r=0;r<t.length;r++){var n=t[r],i=new y,o=new V.A(n[0]),a=new V.A(n[1]),s=o.times(J).div(X).toNumber(),h=a.times(J).div(K).toNumber(),d=o.times(J).dp(0).toString(),u=a.times(J).dp(0).toString();i.setIdByPos(u,d),i.setPos(s,h),r>=1&&i.pushBidirectionalLinkNode(e),l.graph.pushNode(i),e=i.node_id}},this.edit_data=t,this.gis_info=e,this.svg_node=new s,this.layer_uuid=r,this.unit_id=n,this.unit_type=i,this.graph=new g});const Y=H;var Q=function(t,e,r,n,l){var h=this;this.generatePoint=function(){return"ok"==h.edit_data.layers[h.layer_uuid].layer_infomation.station_average?Object.values(h.points).map((function(t){return t.getAverage()})):Object.values(h.points)},this.coordinateAggregation=function(){for(var t=h.edit_data.layers[h.layer_uuid],e=a(h.gis_info,h.unit_id,{N02_004:t.layer_infomation.railway,N02_003:t.layer_infomation.line}),r=0;r<e.length;r++){var n=i(h.gis_info,h.unit_id,e[r]),s=o(h.gis_info,h.unit_id,e[r]).coordinates;h.parseCoordinates(s,n.N02_005)}},this.parseCoordinates=function(t,e){for(var r=0;r<t.length;r++){var n=t[r],i=new V.A(n[0]),o=new V.A(n[1]),a=i.times(J).div(X).toNumber(),s=o.times(J).div(K).toNumber(),l=i.times(J).dp(0).toString()+"p"+o.times(J).dp(0).toString(),d=new E("point",e);d.pushCoordinateId(l,a,s),e in h.points?h.points[e].includePath(d):h.points[e]=d}},this.edit_data=t,this.gis_info=e,this.svg_node=new s,this.layer_uuid=r,this.unit_id=n,this.unit_type=l,this.points={}};const U=Q;var W=function(t,e,r,n,i){var s=this;this.generatePath=function(){var t=s.edit_data.layers[s.layer_uuid],e="ok"==t.layer_infomation.path_join,r=Number(t.layer_infomation.threshold),n=Number(t.layer_infomation.thinoout),i=a(s.gis_info,s.unit_id,{pref:t.layer_infomation.pref});if(e)return function(){for(var t=[],e=0;e<i.length;e++)for(var a=o(s.gis_info,s.unit_id,i[e]),l=s.parseCoordinates(a.coordinates),h=l.pos_order.length,d=0;d<=t.length;d++){if(d>=t.length-1){t.push(l);break}if(t[d].pos_order.length<=h){t.splice(d,0,l);break}}for(var u=function(){for(var e=0,r=0;r<t.length;){for(var n=r+1;n<t.length;){var i=t[r],o=t[n];if(i.getLastNodeId()==o.getFirstNodeId());else if(i.getLastNodeId()==o.getLastNodeId())o.reversePosOrder();else if(i.getFirstNodeId()==o.getFirstNodeId())i.reversePosOrder();else{if(i.getFirstNodeId()!=o.getLastNodeId()){n++;continue}i.reversePosOrder(),o.reversePosOrder()}i.includePathOrder(o,0),t[r]=i,t.splice(n,1),e++}r++}return e},c=u();c>0;)c=u();for(var f=0;f<t.length;)t[f].pos_order.length<r?t.splice(f,1):f++;if(n>0)for(var p=function(e){var r=t[e].pos_order.length-1;t[e].pos_order=t[e].pos_order.filter((function(t,e){return e%n==0||e==r}))},g=0;g<t.length;g++)p(g);return t}();for(var l=[],h=0;h<i.length;h++){var d=o(s.gis_info,s.unit_id,i[h]).coordinates;if(!(d.length<r)){var u=s.parseCoordinates(d);l.push(u)}}return l},this.parseCoordinates=function(t){for(var e=new E("path"),r=0;r<t.length;r++){var n=t[r],i=new V.A(n[0]),o=new V.A(n[1]),a=i.times(J).div(X).toNumber(),s=o.times(J).div(K).toNumber(),l=i.times(J).dp(0).toString()+"p"+o.times(J).dp(0).toString();e.pushPosIds(l),e.pushCoordinateId(l,a,s)}return e},this.edit_data=t,this.gis_info=e,this.layer_uuid=r,this.unit_id=n,this.unit_type=i};const Z=W;var tt=function(t,e,r,n,i){var s=this;this.generatePath=function(){var t=s.edit_data.layers[s.layer_uuid],e="ok"==t.layer_infomation.path_join,r=Number(t.layer_infomation.threshold),n=Number(t.layer_infomation.thinoout),i=a(s.gis_info,s.unit_id,{lake:t.layer_infomation.lake});if(e)return function(){for(var t=[],e=0;e<i.length;e++)for(var a=o(s.gis_info,s.unit_id,i[e]),l=s.parseCoordinates(a.coordinates),h=l.pos_order.length,d=0;d<=t.length;d++){if(d>=t.length-1){t.push(l);break}if(t[d].pos_order.length<=h){t.splice(d,0,l);break}}for(var u=function(){for(var e=0,r=0;r<t.length;){for(var n=r+1;n<t.length;){var i=t[r],o=t[n];if(i.getLastNodeId()==o.getFirstNodeId());else if(i.getLastNodeId()==o.getLastNodeId())o.reversePosOrder();else if(i.getFirstNodeId()==o.getFirstNodeId())i.reversePosOrder();else{if(i.getFirstNodeId()!=o.getLastNodeId()){n++;continue}i.reversePosOrder(),o.reversePosOrder()}i.includePathOrder(o,0),t[r]=i,t.splice(n,1),e++}r++}return e},c=u();c>0;)c=u();for(var f=0;f<t.length;)t[f].pos_order.length<r?t.splice(f,1):f++;if(n>0)for(var p=function(e){var r=t[e].pos_order.length-1;t[e].pos_order=t[e].pos_order.filter((function(t,e){return e%n==0||e==r}))},g=0;g<t.length;g++)p(g);return t}();for(var l=[],h=0;h<i.length;h++){var d=o(s.gis_info,s.unit_id,i[h]).coordinates;if(!(d.length<r)){var u=s.parseCoordinates(d);l.push(u)}}return l},this.parseCoordinates=function(t){for(var e=new E("path"),r=0;r<t.length;r++){var n=t[r],i=new V.A(n[0]),o=new V.A(n[1]),a=i.times(J).div(X).toNumber(),s=o.times(J).div(K).toNumber(),l=i.times(J).dp(0).toString()+"p"+o.times(J).dp(0).toString();e.pushPosIds(l),e.pushCoordinateId(l,a,s)}return e},this.edit_data=t,this.gis_info=e,this.layer_uuid=r,this.unit_id=n,this.unit_type=i};const et=tt;const rt=function(){var t=this;this.pushNode=function(e){return t.svg_tree.push(e),t.svg_tree.length-1},this.pushChild=function(e,r){t.svg_tree[e].linkChild(r)},this.svg_tree=[]};var nt=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},it=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},ot=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},at=function(t,e){var r=this;this.parser=function(){for(var t=r.edit_data.layers_order,e=0;e<t.length;e++)r.parserLayer(t[e])},this.getLayerName=function(t){var e=r.edit_data.layers[t],n=e.unit_id;switch(r.gis_info.id_type[n]){case"RailroadSection":return"鉄道_"+e.layer_infomation.railway+"_"+e.layer_infomation.line;case"Station":return"駅_"+e.layer_infomation.railway+"_"+e.layer_infomation.line;case"Coast":return"海岸線_"+e.layer_infomation.pref;case"Lake":return"湖_"+e.layer_infomation.lake}return"不明"},this.parserLayer=function(t){var e,n=r.edit_data.layers[t].unit_id,i=(r.gis_info.id_type[n],r.switchParserLayer(t));r.graph_coordinate_dict[r.getLayerName(t)]?(e=r.graph_coordinate_dict[r.getLayerName(t)]).push.apply(e,it([],nt(i),!1)):r.graph_coordinate_dict[r.getLayerName(t)]=i},this.toSVGPoint=function(t,e){for(var n=e.pos_order,i=e.coordinate_name,o=e.coordinates,a=new Map,l=0;l<n.length;l++){var h=o.get(n[l]),d=new s;d.setTag("circle"),d.pushAttributeNum("cx",h.x),d.pushAttributeNum("cy",h.y),d.pushAttributeNum("r",4),d.pushAttribute("stroke","none"),d.pushAttribute("stroke-width","0"),d.pushAttribute("fill","black");var u=r.svg_kit.pushNode(d);if(i)if(a.has(i))f=a.get(i),r.svg_kit.pushChild(f,u);else{var c=new s;c.setTag("g"),c.pushAttribute("id",i),c.linkChild(u);var f=r.svg_kit.pushNode(c);t.linkChild(f),a.set(i,f)}else t.linkChild(u)}},this.toSVGPath=function(t,e){var i=e.pos_order,o=new s,a=e.coordinates;o.pushComment(String(e.coordinate_expression_id)),o.setTag("path");var l="rgb("+String(n(50,200))+","+String(n(50,200))+","+String(n(50,200))+")";o.pushAttribute("stroke",l),o.pushAttribute("stroke-width","2"),o.pushAttribute("fill","none");var h=a.get(i[0]);o.pushSvgCommand("M",h.x,h.y);for(var d=0;d<i.length;d++){var u=a.get(i[d]);o.pushSvgCommand("L",u.x,u.y)}var c=r.svg_kit.pushNode(o);t.linkChild(c)},this.toSVG=function(){for(var t=Object.keys(r.graph_coordinate_dict),e=0;e<t.length;e++){var n=t[e],i=r.graph_coordinate_dict[n],o=new s;o.setTag("g"),o.pushAttribute("id",n);var a=r.svg_kit.pushNode(o);r.svg_kit.pushChild(0,a);for(var l=0;l<i.length;l++){var h=i[l];h.coordinates,0!=h.pos_order.length&&("path"==h.getType()&&r.toSVGPath(o,h),"point"==h.getType()&&r.toSVGPoint(o,h))}}return r.svg_kit.svg_tree[0].generate(r.svg_kit.svg_tree)},this.scaling=function(){var t=r.searchCoordinateLeftTop(),e=r.searchCoordinateRightBottom();r.moveCoordinateOrigin(t);var n={x:e.x-t.x,y:e.y-t.y},i=(0,V.A)(r.edit_data.width).div((0,V.A)(n.x)).toNumber(),o=(0,V.A)(r.edit_data.height).div((0,V.A)(n.y)).toNumber(),a=Math.min(i,o);r.moveCoordinateReduction(a),r.invertedCoordinate(),r.moveCoordinateOrigin(r.searchCoordinateLeftTop()),r.decimalPlaceRound()},this.decimalPlaceRound=function(){for(var t,e,n=Object.values(r.graph_coordinate_dict).flat(),i=0;i<n.length;i++){var o=n[i],a=o.coordinates;o.pos_order;try{for(var s=(t=void 0,ot(a.values())),l=s.next();!l.done;l=s.next()){var h=l.value;h.x=(0,V.A)(h.x).dp(r.edit_data.decimal_place).toNumber(),h.y=(0,V.A)(h.y).dp(r.edit_data.decimal_place).toNumber()}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}}},this.invertedCoordinate=function(){for(var t,e,n=Object.values(r.graph_coordinate_dict).flat(),i=0;i<n.length;i++){var o=n[i],a=o.coordinates;o.pos_order;try{for(var s=(t=void 0,ot(a.values())),l=s.next();!l.done;l=s.next()){var h=l.value;h.y=(0,V.A)(r.edit_data.height).minus((0,V.A)(h.y)).toNumber()}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}}},this.moveCoordinateReduction=function(t){for(var e,n,i=Object.values(r.graph_coordinate_dict).flat(),o=0;o<i.length;o++){var a=i[o],s=a.coordinates;a.pos_order;try{for(var l=(e=void 0,ot(s.values())),h=l.next();!h.done;h=l.next()){var d=h.value;d.x=(0,V.A)(d.x).times((0,V.A)(t)).toNumber(),d.y=(0,V.A)(d.y).times((0,V.A)(t)).toNumber()}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}}},this.moveCoordinateOrigin=function(t){for(var e,n,i=Object.values(r.graph_coordinate_dict).flat(),o=0;o<i.length;o++){var a=i[o],s=a.coordinates;a.pos_order;try{for(var l=(e=void 0,ot(s.values())),h=l.next();!h.done;h=l.next()){var d=h.value;d.x=d.x-t.x,d.y=d.y-t.y}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}}},this.searchCoordinateLeftTop=function(){for(var t,e,n=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=Object.values(r.graph_coordinate_dict).flat(),a=0;a<o.length;a++){var s=o[a],l=s.coordinates;s.pos_order;try{for(var h=(t=void 0,ot(l.values())),d=h.next();!d.done;d=h.next()){var u=d.value;n>u.x&&(n=u.x),i>u.y&&(i=u.y)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}}return{x:n,y:i}},this.searchCoordinateRightBottom=function(){for(var t,e,n=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=Object.values(r.graph_coordinate_dict).flat(),a=0;a<o.length;a++){var s=o[a],l=s.coordinates;s.pos_order;try{for(var h=(t=void 0,ot(l.values())),d=h.next();!d.done;d=h.next()){var u=d.value;n<u.x&&(n=u.x),i<u.y&&(i=u.y)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}}return{x:n,y:i}},this.switchParserLayer=function(t){var e=r.edit_data.layers[t].unit_id,n=r.gis_info.id_type[e];switch(n){case"RailroadSection":return(o=new Y(r.edit_data,r.gis_info,t,e,n)).coordinateAggregation(),o.generatePath();case"Station":var i=new U(r.edit_data,r.gis_info,t,e,n);return i.coordinateAggregation(),i.generatePoint();case"Coast":return(o=new Z(r.edit_data,r.gis_info,t,e,n)).generatePath();case"Lake":var o;return(o=new et(r.edit_data,r.gis_info,t,e,n)).generatePath()}},this.edit_data=t,this.gis_info=e,this.svg_kit=new rt,this.graph_coordinate_dict={};var i=new s;i.setTag("svg"),i.pushAttribute("xmlns","http://www.w3.org/2000/svg"),i.pushAttributeNum("width",t.width),i.pushAttributeNum("height",t.height),this.svg_kit.pushNode(i)};const st=at;self.addEventListener("message",(function(t){var e=new st(t.data.edit_data,t.data.gis_info);e.parser(),e.scaling();var r=e.toSVG();self.postMessage(r)}),!1)}},n={};function i(t){var e=n[t];if(void 0!==e)return e.exports;var o=n[t]={id:t,loaded:!1,exports:{}};return r[t].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=r,i.x=()=>{var t=i.O(void 0,[188],(()=>i(628)));return t=i.O(t)},t=[],i.O=(e,r,n,o)=>{if(!r){var a=1/0;for(d=0;d<t.length;d++){for(var[r,n,o]=t[d],s=!0,l=0;l<r.length;l++)(!1&o||a>=o)&&Object.keys(i.O).every((t=>i.O[t](r[l])))?r.splice(l--,1):(s=!1,o<a&&(a=o));if(s){t.splice(d--,1);var h=n();void 0!==h&&(e=h)}}return e}o=o||0;for(var d=t.length;d>0&&t[d-1][2]>o;d--)t[d]=t[d-1];t[d]=[r,n,o]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,r)=>(i.f[r](t,e),e)),[])),i.u=t=>t+".js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{var t={628:1};i.f.i=(e,r)=>{t[e]||importScripts(i.p+i.u(e))};var e=self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[],r=e.push.bind(e);e.push=e=>{var[n,o,a]=e;for(var s in o)i.o(o,s)&&(i.m[s]=o[s]);for(a&&a(i);n.length;)t[n.pop()]=1;r(e)}})(),e=i.x,i.x=()=>i.e(188).then(e);i.x()})();