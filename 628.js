(()=>{"use strict";var t,e,r={628:(t,e,r)=>{new EventTarget;function n(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}var o=function(t,e,r){return t.gis_data[e].features[r].geometry},i=function(t,e,r){for(var n=t.gis_data[e],o=[],i=0;i<n.features.length;i++){for(var a=n.features[i].properties,s=Object.keys(r),l=!0,h=0;h<s.length;h++){var d=s[h],u=r[d];if(a[d]!=u){l=!1;break}}l&&o.push(i)}return o};const a=function(){var t=this;this.generate=function(e){return t.generateComment()+" "+t.generateStartTag()+" "+t.generateElementTag()+" "+t.generateChildren(e)+" "+t.generateEndTag()+" "},this.pushSvgCommand=function(e,r,n){var o={command:e,x:String(r),y:String(n)};t.svg_command.push(o)},this.setTag=function(e){t.tag=e},this.setElement=function(e){t.element=e},this.linkChild=function(e){t.children.push(e)},this.pushAttribute=function(e,r){t.attributes[e]=r},this.pushComment=function(e){t.svg_comment.push(e)},this.pushAttributeNum=function(e,r){t.attributes[e]=r.toString()},this.generateSvgCommand=function(){if(0==t.svg_command.length)return"";var e="";e+='d="';for(var r=0;r<t.svg_command.length;r++){var n=t.svg_command[r],o=" ";o+=n.command,"none"!=n.x&&(o+=" ",o+=n.x),"none"!=n.y&&(o+=" ",o+=n.y),e+=o}return e+='"'},this.generateStartTag=function(){return"<"+t.tag+" "+t.generateAttributeTag()+" "+t.generateSvgCommand()+" >"},this.generateElementTag=function(){return t.element},this.generateEndTag=function(){return"</"+t.tag+">"},this.generateComment=function(){for(var e="",r=0;r<t.svg_comment.length;r++)e+="\x3c!--"+t.svg_comment[r]+"--\x3e\n";return e},this.generateChildren=function(e){for(var r=" ",n=0;n<t.children.length;n++)r+=e[t.children[n]].generate(e),r+=" ";return r},this.generateAttributeTag=function(){for(var e="",r=Object.keys(t.attributes),n=0;n<r.length;n++){var o=r[n];e+=" "+o+' = "'+t.attributes[o]+'" '}return e},this.tag="",this.children=[],this.element="",this.attributes={},this.svg_command=[],this.svg_comment=[]};var s=function(t,e,r){var n=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/(h(t,e)*h(t,r));return Math.acos(n)},l=function(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.pow(r,2)+Math.pow(n,2)},h=function(t,e){var r=e.x-t.x,n=e.y-t.y,o=Math.pow(r,2)+Math.pow(n,2);return Math.sqrt(o)},d=s({x:0,y:0},{x:1,y:0},{x:0,y:1}),u=function(t){return Object.assign(Object.create(Object.getPrototypeOf(t)),t)},c=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},f=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};const p=function(){var t=this;this.pushNode=function(e){if(t.graph.has(e.node_id)){for(var r=t.graph.get(e.node_id),n=0;n<e.bidirectional_link_id_list.length;n++){var o=e.bidirectional_link_id_list[n];r.pushBidirectionalLinkNode(o)}t.graph.set(e.node_id,r)}else t.graph.set(e.node_id,e);for(n=0;n<e.bidirectional_link_id_list.length;n++){var i=e.bidirectional_link_id_list[n],a=t.graph.get(i);a.pushBidirectionalLinkNode(e.node_id),t.graph.set(i,a)}},this.getTerminationPointID=function(){if(0==t.graph.size)return[];for(var e=[],r=1;0==e.length;)e=t.getPointID(r),r++;return e},this.getOddBranchPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),o=0;o<n.length;o++){var i=n[o],a=t.graph.get(i);a.bidirectional_link_id_list.length%2==1&&a.bidirectional_link_id_list.length>=3&&e.push(i)}return e},this.getEvenBranchPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),o=0;o<n.length;o++){var i=n[o],a=t.graph.get(i);a.bidirectional_link_id_list.length%2==0&&a.bidirectional_link_id_list.length>=4&&e.push(i)}return e},this.getOddPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),o=0;o<n.length;o++){var i=n[o];t.graph.get(i).bidirectional_link_id_list.length%2!=1||e.push(i)}return e},this.getEvenPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),o=0;o<n.length;o++){var i=n[o];t.graph.get(i).bidirectional_link_id_list.length%2!=0||e.push(i)}return e},this.getPointID=function(e){for(var r=[],n=t.graph.keys(),o=Array.from(n),i=0;i<o.length;i++){var a=o[i];t.graph.get(a).bidirectional_link_id_list.length!=e||r.push(a)}return r},this.deleteLinkNode=function(e,r){var n=t.graph.get(e);n.bidirectional_link_id_list=n.bidirectional_link_id_list.filter((function(t,e){return t!=r}))},this.replaceLinkNode=function(e,r,n){for(var o=t.graph.get(e),i=0;i<o.bidirectional_link_id_list.length;i++)o.bidirectional_link_id_list[i]==r&&(o.bidirectional_link_id_list[i]=n)},this.separationLinkNode=function(e,r,n){var o=t.graph.get(e),i=o.copyGraphNode(),a=o.copyGraphNode();i.bidirectional_link_id_list=f([],c(r),!1),a.bidirectional_link_id_list=o.bidirectional_link_id_list.filter((function(t){return!r.includes(t)}));var s=o.node_id,l=s+n;i.node_id=l,t.graph.set(i.node_id,i),t.graph.set(a.node_id,a);for(var h=0;h<r.length;h++)t.replaceLinkNode(r[h],s,l);return l},this.intersectionExtraction=function(){for(var e=[],r=function(e){for(var r=t.graph.get(e),n=r.bidirectional_link_id_list,o=Number.MIN_SAFE_INTEGER,i=[],a=0;a<n.length;a++)for(var l=n[a],h=t.graph.get(l),d=a+1;d<n.length;d++){var u=n[d],c=t.graph.get(u),f=s({x:r.x,y:r.y},{x:h.x,y:h.y},{x:c.x,y:c.y});o<f&&(o=f,i=[l,u])}return i},n=function(e,r){var n=t.graph.get(e),o=n.bidirectional_link_id_list.filter((function(t,e){return!r.includes(t)}));if(2!=o.length)return!1;var i=t.graph.get(o[0]),a=t.graph.get(o[1]);return s({x:n.x,y:n.y},{x:i.x,y:i.y},{x:a.x,y:a.y})<=d},o=t.getEvenBranchPointID(),i=0;o.length>0;){var a=o[0],l=r(a);n(a,l)?e.push(a):t.separationLinkNode(a,l,"s"+i),i++,o=t.getEvenBranchPointID().filter((function(t,r){return!e.includes(t)}))}},this.loopLinePoint=function(e,r){var n=r[0],o=t.graph.get(n),i=u(o),a=u(o);i.bidirectional_link_id_list=[o.bidirectional_link_id_list[0]],a.bidirectional_link_id_list=[o.bidirectional_link_id_list[1]];var s=a.node_id,l=s+"c";a.node_id=l,t.graph.set(i.node_id,i),t.graph.set(a.node_id,a),t.replaceLinkNode(o.bidirectional_link_id_list[1],s,l)},this.graph=new Map};var g=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},v=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};const _=function t(){var e=this;this.copyGraphNode=function(){var r=new t;return r.x=e.x,r.y=e.y,r.node_id=e.node_id,r.bidirectional_link_id_list=v([],g(e.bidirectional_link_id_list),!1),r},this.pushBidirectionalLinkNode=function(t){e.bidirectional_link_id_list.push(t)},this.setId=function(t){e.node_id=t},this.setIdByPos=function(t,r){var n=t+"p"+r;e.node_id=n},this.setX=function(t){e.x=t},this.setY=function(t){e.y=t},this.setPos=function(t,r){e.x=t,e.y=r},this.getPos=function(){return{x:e.x,y:e.y}},this.node_id="",this.x=0,this.y=0,this.bidirectional_link_id_list=[]};var y=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const m=function(){var t=this;this.getPaths=function(e){return t.node_paths.has(e)?t.node_paths.get(e):[]},this.isValidNode=function(e){var r,n;if(!t.node_paths.has(e))return!1;var o=t.node_paths.get(e);try{for(var i=y(o),a=i.next();!a.done;a=i.next())if(a.value>=0)return!0}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return!1},this.otheGroupPath=function(e,r){var n,o,i,a;if(!t.node_paths.has(e))return-1;if(!t.node_paths.has(r))return-1;var s=t.node_paths.get(e),l=t.node_paths.get(r);try{for(var h=y(s),d=h.next();!d.done;d=h.next()){var u=d.value;try{for(var c=(i=void 0,y(l)),f=c.next();!f.done;f=c.next())if(u==f.value)return u}catch(t){i={error:t}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}}}catch(t){n={error:t}}finally{try{d&&!d.done&&(o=h.return)&&o.call(h)}finally{if(n)throw n.error}}return-1},this.pushNode=function(e,r){if(t.node_paths.has(e)){var n=t.node_paths.get(e);n.push(r),t.node_paths.set(e,n)}else t.node_paths.set(e,[r])},this.node_paths=new Map};var x=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},b=function(){var t=this;this.pushArrivedNode=function(e){t.arrived_nodes.push(e)},this.isArrivedNode=function(e){return t.arrived_nodes.includes(e)},this.includeArrivedNode=function(e){var r=[];r=(r=r.concat(t.arrived_nodes)).concat(e.arrived_nodes),t.arrived_nodes=r},this.setCoordinateExpressionId=function(e){t.coordinate_expression_id=e},this.getCoordinateExpressionId=function(){return t.coordinate_expression_id},this.hasCoordinateExpressionId=function(){return t.coordinate_expression_id>=0},this.includeRoute=function(e){var r=[];r=(r=r.concat(t.routes)).concat(e.routes),t.routes=r},this.replaceRoute=function(e){t.routes=[],t.routes=t.routes.concat(e)},this.pushRoute=function(e){t.routes.push(e)},this.pushRoutes=function(e){var r,n;try{for(var o=x(e),i=o.next();!i.done;i=o.next()){var a=i.value;t.routes.push(a)}}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},this.setDistance=function(e){t.distance=e},this.distance=-1,this.routes=[],this.coordinate_expression_id=-1,this.arrived_nodes=[]};const w=b;var N=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const k=function(){var t=this;this.getOddBranch=function(){var e,r,n=[];try{for(var o=N(t.route.keys()),i=o.next();!i.done;i=o.next()){var a=i.value;t.route.get(a).size%2==1&&n.push(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n},this.getBranch=function(e){var r,n,o=[];try{for(var i=N(t.route.keys()),a=i.next();!a.done;a=i.next()){var s=a.value;t.route.get(s).size==e&&o.push(s)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o},this.getTerminal=function(){var e,r,n=[];try{for(var o=N(t.route.keys()),i=o.next();!i.done;i=o.next()){var a=i.value;1==t.route.get(a).size&&n.push(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n},this.getBranchNodes=function(){var e,r,n=[];try{for(var o=N(t.route.keys()),i=o.next();!i.done;i=o.next()){var a=i.value;t.route.get(a).size>=3&&n.push(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n},this.getNodeKeys=function(){return t.route.keys()},this.getNodeKeysList=function(){return Array.from(t.route.keys())},this.getPathContacts=function(e,r){if(!t.route.has(e))return[];var n=t.route.get(e);return n.has(r)?n.get(r):[]},this.hasPathContact=function(e,r){if(!t.route.has(e))return!1;var n=t.route.get(e);return!!n.has(r)&&0!=n.get(r).length},this.getSortPathContact=function(e,r,n){if(!t.route.has(r))return[];var o,i,a=t.route.get(r);if(!a.has(n))return[];var s=a.get(n);return e?(o=-1,i=1):(o=1,i=-1),s.sort((function(t,e){var r=t,n=e;return r.distance>n.distance?o:r.distance<n.distance?i:0})),s},this.getAllSortPathContact=function(e){var r,n,o=t.getAllPathContact();return e?(r=-1,n=1):(r=1,n=-1),o.sort((function(t,e){var o=t,i=e;return o.distance>i.distance?r:o.distance<i.distance?n:0})),o},this.getAllPathContact=function(){var e,r,n,o,i=[];try{for(var a=N(t.route.keys()),s=a.next();!s.done;s=a.next()){var l=s.value,h=t.route.get(l);try{for(var d=(n=void 0,N(h.keys())),u=d.next();!u.done;u=d.next()){var c=u.value,f=h.get(c);i=i.concat(f)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return i},this.getPathContact=function(e,r){return t.route.get(e).get(r)[0]},this.getMinPathContact=function(e,r){for(var n,o=t.route.get(e).get(r),i=Number.MAX_SAFE_INTEGER,a=0;a<o.length;a++)i>o[a].distance&&(n=o[a]);return n},this.buildNextPaths=function(e){var r,n,o,i;try{for(var a=N(e),s=a.next();!s.done;s=a.next()){var l=s.value,h=new Map;try{for(var d=(o=void 0,N(e)),u=d.next();!u.done;u=d.next()){var c=u.value;l!=c&&h.set(c,[])}}catch(t){o={error:t}}finally{try{u&&!u.done&&(i=d.return)&&i.call(d)}finally{if(o)throw o.error}}t.route.set(l,h)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},this.buildPaths=function(e){for(var r=e.length,n=0;n<r;n++){for(var o=e[n],i=new Map,a=0;a<r;a++){var s=e[a];if(n!=a)i.set(s,[]);else{var l=new w;l.setDistance(-1),l.coordinate_expression_id=-2,i.set(s,[l])}}t.route.set(o,i)}},this.setSemiRoute=function(e,r,n){if(!t.route.has(e)){var o=new Map;t.route.set(e,o)}var i=t.route.get(e),a=[n];i.set(r,a),t.route.set(e,i)},this.pushSemiRoute=function(e,r,n){if(!t.route.has(e)){var o=new Map;t.route.set(e,o)}var i=t.route.get(e);i.has(r)||i.set(r,[]);var a=i.get(r);a.push(n),i.set(r,a),t.route.set(e,i)},this.pushRoute=function(e,r,n){if(!t.route.has(e)){var o=new Map;t.route.set(e,o)}t.route.has(r)||(o=new Map,t.route.set(r,o));var i=t.route.get(e),a=t.route.get(r);if(!i.has(r)){var s=[];i.set(r,s)}a.has(e)||(s=[],a.set(e,s));var l=i.get(r),h=a.get(e);l.push(n),h.push(n),i.set(r,l),a.set(e,h),t.route.set(e,i),t.route.set(r,a)},this.pushRoutes=function(e,r,n){var o,i;try{for(var a=N(n),s=a.next();!s.done;s=a.next()){var l=s.value;t.pushRoute(e,r,l)}}catch(t){o={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(o)throw o.error}}},this.route=new Map};var P=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const S=function(){var t=this;this.generateNext=function(t){var e,r,n=new k;try{for(var o=P(t.path.values()),i=o.next();!i.done;i=o.next()){var a=i.value,s=a.getDistance(),l=a.getFirstNodeId(),h=a.getLastNodeId(),d=new w;d.setDistance(s),d.pushRoute(a.coordinate_expression_id),d.setCoordinateExpressionId(a.coordinate_expression_id),n.pushRoute(l,h,d)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return n},this.generateRouteHalf=function(e,r,n){var o=new k;return o=t.extractionEnumeration(e,r,o,n)},this.generateRoute=function(e,r){var n,o,i=new k;try{for(var a=P(e.graph.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;i=t.extractionEnumeration(e,r,i,l)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i},this.generateRouteShortest=function(e,r){var n,o,i=new k;try{for(var a=P(e.graph.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;i=t.extractionGraphDetermination(e,r,i,l)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}return i},this.generateGraphExtraction=function(t,e){var r,n,o=new p;try{for(var i=P(e.path.values()),a=i.next();!a.done;a=i.next()){var s=a.value,l=(s.getDistance(),s.getFirstNodeId()),h=s.getLastNodeId(),d=t.graph.get(l),u=t.graph.get(h),c=new _;c.setPos(d.x,d.y),c.setId(l),o.pushNode(c);var f=new _;f.setPos(u.x,u.y),f.setId(h),f.pushBidirectionalLinkNode(l),o.pushNode(f)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o},this.extractionGraphDetermination=function(t,e,r,n){var o,i,a,s,l,h=[],d=new Map,u=function(t){return h.push(t)-1};u(n);try{for(var c=P(t.graph.keys()),f=c.next();!f.done;f=c.next()){var p=f.value;d.set(p,Number.MAX_SAFE_INTEGER)}}catch(t){o={error:t}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}for(d.set(n,0);h.length>0;){var g=(l=void 0,l=h[0],h.shift(),l),v=t.graph.get(g).bidirectional_link_id_list;try{for(var _=(a=void 0,P(v)),y=_.next();!y.done;y=_.next()){var m=y.value;if(g!=m&&n!=m){var x=e.getMinPathContact(g,m),b=x.distance+d.get(g),N=d.get(m);if(!(N<=b)){N>b&&(d.set(m,b),u(m));var k=new w;if(k.setDistance(b),k.setCoordinateExpressionId(-3),r.hasPathContact(n,g)){var S=r.getMinPathContact(n,g);k.includeRoute(S)}k.pushRoute(x.coordinate_expression_id),r.setSemiRoute(n,m,k)}}}}catch(t){a={error:t}}finally{try{y&&!y.done&&(s=_.return)&&s.call(_)}finally{if(a)throw a.error}}}return r},this.extractionEnumeration=function(t,e,r,n){var o=function(i,a,s){var l,h,d,u,c,f,p,g,v=i[i.length-1],_=t.graph.get(v).bidirectional_link_id_list;if(i.length<2)try{for(var y=P(_),m=y.next();!m.done;m=y.next()){var x=m.value,b=e.getPathContacts(v,x);try{for(var N=(d=void 0,P(b)),k=N.next();!k.done;k=N.next()){var S=k.value;(R=i).push(x),(j=a).push(S.coordinate_expression_id),o(R,j,S.distance),R.pop(),j.pop()}}catch(t){d={error:t}}finally{try{k&&!k.done&&(u=N.return)&&u.call(N)}finally{if(d)throw d.error}}}}catch(t){l={error:t}}finally{try{m&&!m.done&&(h=y.return)&&h.call(y)}finally{if(l)throw l.error}}else{i[i.length-2];var C=new w;C.setCoordinateExpressionId(-3),C.setDistance(s),C.pushRoutes(a),r.pushSemiRoute(n,v,C);try{for(var I=P(_),A=I.next();!A.done;A=I.next()){x=A.value;var E=e.getPathContacts(v,x);try{for(var O=(p=void 0,P(E)),L=O.next();!L.done;L=O.next()){var T=L.value;if(!a.includes(T.coordinate_expression_id)){var R,j;(R=i).push(x),(j=a).push(T.coordinate_expression_id);var M=s+T.distance;o(R,j,M),R.pop(),j.pop()}}}catch(t){p={error:t}}finally{try{L&&!L.done&&(g=O.return)&&g.call(O)}finally{if(p)throw p.error}}}}catch(t){c={error:t}}finally{try{A&&!A.done&&(f=I.return)&&f.call(I)}finally{if(c)throw c.error}}}};return o([n],[],0),r}};var C=r(543),I=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const A=function(t){var e=this;this.includePathOrder=function(t,r){C.cloneDeep(e.pos_order);var n,o,i=t.pos_order.filter((function(t,e){return e>=r}));e.pos_order=e.pos_order.concat(i);try{for(var a=I(t.coordinates.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;e.coordinates.set(l,t.coordinates.get(l))}}catch(t){n={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(n)throw n.error}}},this.includePath=function(t){var r,n;e.pos_order=e.pos_order.concat(t.pos_order);try{for(var o=I(t.coordinates.keys()),i=o.next();!i.done;i=o.next()){var a=i.value;e.coordinates.set(a,t.coordinates.get(a))}}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}},this.setCoordinateExpressionId=function(t){e.coordinate_expression_id=t},this.reversePosOrder=function(){e.pos_order=e.pos_order.reverse()},this.getDistance=function(){for(var t=0,r=1;r<e.pos_order.length;r++){var n=e.coordinates.get(e.pos_order[r-1]),o=e.coordinates.get(e.pos_order[r]);t+=h(n,o)}return t},this.getFirstNodeId=function(){return e.pos_order[0]},this.getLastNodeId=function(){return e.pos_order[e.pos_order.length-1]},this.pushDebugMessage=function(t,r){e.debug_message.push(t+" x:"+String(r.x)+" y: "+String(r.y))},this.getType=function(){return e.type},this.pushPosIdsIndex=function(t,r){e.pos_order.splice(r,0,t)},this.pushPosIds=function(t){e.pos_order.push(t)},this.pushCoordinateId=function(t,r,n){e.coordinates.set(t,{x:r,y:n}),e.pushPosIds(t)},this.coordinates=new Map,this.type=t,this.debug_message=[],this.pos_order=[]};const E=function(){var t=this;this.getJoinPathCoordinateFlag=function(t,e){if(t.length<2)return[-1,-1];if(e.length<2)return[-1,-1];var r=function(){return t[0]},n=function(){return t[t.length-1]},o=function(){return e[0]},i=function(){return e[e.length-1]};return n()==o()?[0,0]:n()==i()?[0,1]:r()==o()?[1,0]:r()==i()?[1,1]:[-1,-1]},this.getJoinPathFlag=function(e,r){var n=t.path.get(e),o=t.path.get(r);return n.getLastNodeId()==o.getFirstNodeId()?[0,0]:n.getLastNodeId()==o.getLastNodeId()?[0,1]:n.getFirstNodeId()==o.getFirstNodeId()?[1,0]:n.getFirstNodeId()==o.getLastNodeId()?[1,1]:[-1,-1]},this.joinPath=function(e,r){var n=t.path.get(e),o=t.path.get(r);if(n.getLastNodeId()==o.getFirstNodeId());else if(n.getLastNodeId()==o.getLastNodeId())o.reversePosOrder();else if(n.getFirstNodeId()==o.getFirstNodeId())n.reversePosOrder();else{if(n.getFirstNodeId()!=o.getLastNodeId())return!1;n.reversePosOrder(),o.reversePosOrder()}return n.includePathOrder(o,0),t.path.delete(o.coordinate_expression_id),t.path.set(n.coordinate_expression_id,n),!0},this.isAdjoinProcessed=function(e,r,n){for(var o=t.path.get(e),i=-100,a=-102,s=0;s<o.pos_order.length;s++)r==o.pos_order[s]&&(i=s),n==o.pos_order[s]&&(a=s);return 1==Math.abs(i-a)},this.pushProcessed=function(){var e=new A("path"),r=t.path.size;return e.setCoordinateExpressionId(r),t.path.set(r,e),r},this.pushProcessedPos=function(e,r,n){var o=t.pushProcessed(),i=t.path.get(o);return i.pushCoordinateId(e,r,n),t.path.set(o,i),o},this.pushCoordinateId=function(e,r,n,o){var i=t.path.get(e);i.pushCoordinateId(r,n,o),t.path.set(e,i)},this.path=new Map};var O=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},L=function(t,e){var r=this;this.getProcessedPath=function(){return r.processed_path},this.debugNode=function(){var t,e,n=r.graph_container.graph.keys();try{for(var o=O(n),i=o.next();!i.done;i=o.next())for(var a=i.value,s=r.graph_container.graph.get(a),l=0;l<s.bidirectional_link_id_list.length;l++){var h=s.bidirectional_link_id_list[l];r.graph_container.graph.get(h),r.processed_path.pushProcessed()}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},this.startCalc=function(){r.graph_container.intersectionExtraction(),r.graph_container.graph.keys();var t=r.graph_container.getPointID(1),e=r.graph_container.getPointID(2);0==t.length&&e.length>0&&r.graph_container.loopLinePoint(t,e),r.calcTerminationPoint(),r.original_data_coordinate_correction_flag&&r.reliefSeparate()>0&&(r.node_path=new m,r.processed_path=new E,r.bfs_que=[],r.calcTerminationPoint());for(var n=new S,o=n.generateGraphExtraction(r.graph_container,r.processed_path),i=function(){return o.getPointID(2).filter((function(t,e){return o.graph.get(t).bidirectional_link_id_list[0]==o.graph.get(t).bidirectional_link_id_list[1]}))},a=i();a.length>0;){var s=a[0],l=o.graph.get(s).bidirectional_link_id_list[0],h=(r.graph_container.graph.get(s),r.graph_container.graph.get(l).copyGraphNode()),d=h.node_id+"d";h.node_id=d,h.bidirectional_link_id_list=[s],r.graph_container.graph.set(d,h),r.graph_container.deleteLinkNode(l,s),r.graph_container.replaceLinkNode(s,l,d),r.calcReStart(),o=n.generateGraphExtraction(r.graph_container,r.processed_path),a=i()}},this.calcReStart=function(){r.node_path=new m,r.processed_path=new E,r.bfs_que=[],r.calcTerminationPoint()},this.calcTerminationPoint=function(){for(var t=r.graph_container.getTerminationPointID(),e=0;e<t.length;e++){var n=t[e],o=r.graph_container.graph.get(n);if(!r.isValidNodePath(n)){var i=r.processed_path.pushProcessedPos(n,o.x,o.y);r.node_path.pushNode(n,i),r.dfs(n)}}},this.popDfsStack=function(){var t=r.bfs_que[r.bfs_que.length-1];return r.bfs_que.pop(),t},this.isValidNodePath=function(t){return r.node_path.isValidNode(t)},this.dfs=function(t){var e,n,o,i;r.bfs_que=[],r.bfs_que.push(t);var a=r.graph_container.graph.get(t),s=r.node_path.getPaths(t);try{for(var l=O(s),h=l.next();!h.done;h=l.next()){var d=h.value;r.processed_path.pushCoordinateId(d,t,a.x,a.y)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}for(;r.bfs_que.length>0;){r.bfs_que.length;for(var u=r.popDfsStack(),c=r.graph_container.graph.get(u),f=c.bidirectional_link_id_list,p=f.length,g=r.node_path.getPaths(u),v=0;v<p;v++){var _=f[v],y=r.graph_container.graph.get(_);if(!(r.node_path.otheGroupPath(u,_)>=0)){if(p>=3){var m=r.processed_path.pushProcessedPos(u,c.x,c.y);r.processed_path.pushCoordinateId(m,_,y.x,y.y),r.node_path.pushNode(u,m),r.node_path.pushNode(_,m)}else try{for(var x=(o=void 0,O(g)),b=x.next();!b.done;b=x.next()){var w=b.value;r.processed_path.pushCoordinateId(w,_,y.x,y.y),r.node_path.pushNode(_,w)}}catch(t){o={error:t}}finally{try{b&&!b.done&&(i=x.return)&&i.call(x)}finally{if(o)throw o.error}}r.bfs_que.push(_)}}}},this.reliefSeparateTerminalPoint=function(t){var e,n,o,i,a,s=0,h=r.graph_container.graph.get(t);try{for(var d=O(r.processed_path.path.values()),c=d.next();!c.done;c=d.next()){var f=c.value;if(!f.coordinates.has(t))for(var p=2;p<f.pos_order.length-1;p++){var g=f.pos_order[p-1],v=f.pos_order[p],_=f.coordinates.get(g),y=f.coordinates.get(v),m=l(_,y);if(l(_,{x:h.x,y:h.y})<=m){u(r.graph_container.graph.get(t)),h.bidirectional_link_id_list.includes(g)||h.bidirectional_link_id_list.push(g),h.bidirectional_link_id_list.includes(v)||h.bidirectional_link_id_list.push(v);var x=(o=h.getPos(),i=_,a=y,{x:(o.x+i.x+a.x)/3,y:(o.y+i.y+a.y)/3});return h.setPos(x.x,x.y),r.graph_container.replaceLinkNode(g,v,t),r.graph_container.replaceLinkNode(v,g,t),++s}}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(n=d.return)&&n.call(d)}finally{if(e)throw e.error}}return s},this.reliefSeparate=function(){var t,e,n=r.graph_container.getPointID(1),o=0;try{for(var i=O(n),a=i.next();!a.done;a=i.next()){var s=a.value;o+=r.reliefSeparateTerminalPoint(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return o},this.graph_container=t,this.node_path=new m,this.processed_path=new E,this.bfs_que=[],this.original_data_coordinate_correction_flag=e};const T=L;var R=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},j=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},M=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},D=function(){this.getJoinCoordinate=function(t,e){var r,n,o,i;if(0==t.length)return{order:[],coordinates:new Map,joint_index:[]};var a=[],s=new Map,l=[],h=e.path.get(t[0]);a=a.concat(h.pos_order);try{for(var d=R(h.coordinates.keys()),u=d.next();!u.done;u=d.next()){var c=u.value;s.set(c,h.coordinates.get(c))}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}for(var f=1;f<t.length;f++){var p=t[f],g=e.path.get(p),v=M([],j(g.pos_order),!1),_=e.getJoinPathCoordinateFlag(a,v);1==_[0]&&(a=a.reverse()),1==_[1]&&(v=v.reverse());var y=v.filter((function(t,e){return e>0}));l.push(a.length-1),a=a.concat(y);try{for(var m=(o=void 0,R(g.coordinates.keys())),x=m.next();!x.done;x=m.next())c=x.value,s.set(c,g.coordinates.get(c))}catch(t){o={error:t}}finally{try{x&&!x.done&&(i=m.return)&&i.call(m)}finally{if(o)throw o.error}}}return{order:a,coordinates:s,joint_index:l}},this.joinLong=function(t){var e,r,n,o=[],i=[],a=function(t){var e,r;try{for(var n=R(t),o=n.next();!o.done;o=n.next()){var a=o.value;if(i.includes(a))return!0}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return!1},s=t.getAllSortPathContact(!0);if(0==s.length)return[];try{for(var l=R(s),h=l.next();!h.done;h=l.next()){var d=h.value;a(d.routes)||(n=d.routes,i=i.concat(n),o.push(d.routes))}}catch(t){e={error:t}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return o},this.joinContinuity=function(t,e){var r,n;try{for(var o=R(t),i=o.next();!i.done;i=o.next())for(var a=i.value,s=a[0],l=1;l<a.length;l++){var h=a[l];e.joinPath(s,h)}}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return e}};const F=D;const G=function(){var t=this;this.processSharpAngleRemoval=function(t){for(var e=0;e<t.joint_index.length;e++){var r=t.joint_index[e],n=t.order[r-1],o=t.order[r],i=t.order[r+1],a=t.coordinates.get(n),l=t.coordinates.get(o),h=t.coordinates.get(i);if(s(l,a,h)<d)return!0}return!1},this.hasProcessSharpAngleRemovalPath=function(e,r){var n=(new F).getJoinCoordinate(e,r);return t.processSharpAngleRemoval(n)}};var B=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const q=function(t,e){var r=this;this.checkDistance=function(t,e){return r.long?t>e:t<e},this.extractionDetermination=function(t,e,n,o,i){var a=null,s=null,l=function(t){return 1e8*t[0]+1e4*t[1]+t[2]},h=function(t){if(t.length<3)return!1;var e=[t[t.length-3],t[t.length-2],t[t.length-1]];if(function(t){return r.sharp_angle_cash.has(l(t))}(e))return function(t){return r.sharp_angle_cash.get(l(t))}(e);var o=(new G).hasProcessSharpAngleRemovalPath(e,n);return function(t,e){r.sharp_angle_cash.set(l(t),e)}(e,o),o},d=function(n,o,l,u){var c,f,p,g,v,_,y,m,x=n[n.length-1],b=t.graph.get(x).bidirectional_link_id_list;if(n.length<2)try{for(var N=B(b),k=N.next();!k.done;k=N.next()){var P=k.value,S=e.getPathContacts(x,P);try{for(var C=(p=void 0,B(S)),I=C.next();!I.done;I=C.next()){var A=I.value;(D=n).push(P),(F=o).push(A.coordinate_expression_id),d(D,F,A.distance,u),D.pop(),F.pop()}}catch(t){p={error:t}}finally{try{I&&!I.done&&(g=C.return)&&g.call(C)}finally{if(p)throw p.error}}}}catch(t){c={error:t}}finally{try{k&&!k.done&&(f=N.return)&&f.call(N)}finally{if(c)throw c.error}}else{var E;if(i==x)if((null==a||r.checkDistance(l,a.distance))&&((E=new w).setCoordinateExpressionId(-3),E.setDistance(l),E.pushRoutes(o),a=E),u&&(h(o)?u=!1:(null==s||r.checkDistance(l,s.distance))&&((E=new w).setCoordinateExpressionId(-3),E.setDistance(l),E.pushRoutes(o),s=E)),!r.long)return;if(i!=x&&u&&h(o)&&(u=!1),!(n.filter((function(t,e){return t==n[n.length-1]&&e<n.length-1})).length>0))try{for(var O=B(b),L=O.next();!L.done;L=O.next()){P=L.value;var T=e.getPathContacts(x,P);try{for(var R=(y=void 0,B(T)),j=R.next();!j.done;j=R.next()){var M=j.value;if(!o.includes(M.coordinate_expression_id)){var D,F;(D=n).push(P),(F=o).push(M.coordinate_expression_id);var G=l+M.distance;d(D,F,G,u),D.pop(),F.pop()}}}catch(t){y={error:t}}finally{try{j&&!j.done&&(m=R.return)&&m.call(R)}finally{if(y)throw y.error}}}}catch(t){v={error:t}}finally{try{L&&!L.done&&(_=O.return)&&_.call(O)}finally{if(v)throw v.error}}}};return d([o],[],0,r.sharp_angle_removal_flag),r.sharp_angle_removal_flag&&null!=s?s:a},this.searchDeleteClosedPathShort=function(t,e,n,o){for(var i=(new S).generateRouteShortest(n,o),a=[],s=0;s<t.length;s++){for(var l=t[s],h=s+1;h<t.length;h++){var d=t[h];if(i.hasPathContact(l,d)){var u=i.getMinPathContact(l,d);null!=u&&a.push(u)}}r.keep_paths=r.keep_paths.concat(a)}},this.searchDeleteClosedPathLong=function(t,e,n,o){for(var i=[],a=0;a<t.length;a++){for(var s=t[a],l=a+1;l<t.length;l++){var h=t[l],d=r.extractionDetermination(n,o,e,s,h);null!=d&&i.push(d)}r.keep_paths=r.keep_paths.concat(i)}},this.searchDeleteClosedPath=function(t,e,n,o){r.long?r.searchDeleteClosedPathLong(t,e,n,o):r.searchDeleteClosedPathShort(t,e,n,o)},this.deleteClosedPath=function(t){var e,n,o=function(){var t,e,n=[];try{for(var o=B(r.keep_paths),i=o.next();!i.done;i=o.next()){var a=i.value;n=n.concat(a.routes)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return n}();try{for(var i=B(t.path.values()),a=i.next();!a.done;a=i.next()){var s=a.value;o.includes(s.coordinate_expression_id)||t.path.delete(s.coordinate_expression_id)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return t},this.keep_paths=[],this.sharp_angle_removal_flag=t,this.long=e,this.sharp_angle_cash=new Map};var z=r(346),V=new z.A(1e5),J=new z.A(.010966404715491394),X=new z.A(J).times(V),$=new z.A(.0090133729745762),K=($.times(V).div(X),function(t,e,r,n,s){var l=this;this.pathOptimizeLoop=function(t,e,r,n){var o=new S,i=o.generateNext(r);o=null;var a=!1;2==t&&(a=!0);var s=new q(e,a),l=i.getBranch(1),h=1==l.length,d=h?i.getOddBranch():l;return s.searchDeleteClosedPath(d,r,n,i),r=s.deleteClosedPath(r),i=null,s=null,{branch1_flag:h,grah_paths:r}},this.pathOptimize=function(t,e,r,n){for(var o=10;o>0;){var i=l.pathOptimizeLoop(t,e,r,n);r=i.grah_paths,i.branch1_flag?o--:o=-1}return r},this.pathJoin=function(t,e){var r=new F,n=new S,o=n.generateNext(t),i=n.generateRoute(e,o),a=r.joinLong(i);return t=r.joinContinuity(a,t),r=null,n=null,o=null,i=null,a=null,t},this.generatePath=function(){var t=l.edit_data.layers[l.layer_uuid],e="ok"==t.layer_infomation.path_optimize,r="ok"==t.layer_infomation.path_join,n="ok"==t.layer_infomation.sharp_angle_removal,o="ok"==t.layer_infomation.original_data_coordinate_correction,i=Number(t.layer_infomation.path_optimize_closed_type),a=new T(l.graph,o);a.startCalc();var s=a.getProcessedPath(),h=(new S).generateGraphExtraction(l.graph,s);return e&&(s=l.pathOptimize(i,n,s,h)),r&&(s=l.pathJoin(s,h)),Array.from(s.path.values())},this.coordinateAggregation=function(){for(var t=l.edit_data.layers[l.layer_uuid],e=i(l.gis_info,l.unit_id,{N02_004:t.layer_infomation.railway,N02_003:t.layer_infomation.line}),r=0;r<e.length;r++){var n=o(l.gis_info,l.unit_id,e[r]).coordinates;l.parseCoordinatesToGraph(n)}},this.parseCoordinatesToGraph=function(t){for(var e="",r=0;r<t.length;r++){var n=t[r],o=new _,i=new z.A(n[0]),a=new z.A(n[1]),s=i.times(V).div(J).toNumber(),h=a.times(V).div($).toNumber(),d=i.times(V).dp(0).toString(),u=a.times(V).dp(0).toString();o.setIdByPos(u,d),o.setPos(s,h),r>=1&&o.pushBidirectionalLinkNode(e),l.graph.pushNode(o),e=o.node_id}},this.edit_data=t,this.gis_info=e,this.svg_node=new a,this.layer_uuid=r,this.unit_id=n,this.unit_type=s,this.graph=new p});const H=K;var U=function(t,e,r,n,s){var l=this;this.generatePoint=function(){return l.points},this.coordinateAggregation=function(){for(var t=l.edit_data.layers[l.layer_uuid],e=i(l.gis_info,l.unit_id,{N02_004:t.layer_infomation.railway,N02_003:t.layer_infomation.line}),r=0;r<e.length;r++){var n=o(l.gis_info,l.unit_id,e[r]).coordinates;l.parseCoordinates(n)}},this.parseCoordinates=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=new z.A(r[0]),o=new z.A(r[1]),i=n.times(V).div(J).toNumber(),a=o.times(V).div($).toNumber(),s=n.times(V).dp(0).toString()+"p"+o.times(V).dp(0).toString(),h=new A("point");h.pushCoordinateId(s,i,a),l.points.push(h)}},this.edit_data=t,this.gis_info=e,this.svg_node=new a,this.layer_uuid=r,this.unit_id=n,this.unit_type=s,this.points=[]};const Y=U;var Q=function(t,e,r,n,a){var s=this;this.generatePath=function(){var t=s.edit_data.layers[s.layer_uuid],e="ok"==t.layer_infomation.path_join,r=Number(t.layer_infomation.threshold),n=Number(t.layer_infomation.thinoout),a=i(s.gis_info,s.unit_id,{pref:t.layer_infomation.pref});if(e)return function(){for(var t=[],e=0;e<a.length;e++)for(var i=o(s.gis_info,s.unit_id,a[e]),l=s.parseCoordinates(i.coordinates),h=l.pos_order.length,d=0;d<=t.length;d++){if(d>=t.length-1){t.push(l);break}if(t[d].pos_order.length<=h){t.splice(d,0,l);break}}for(var u=function(){for(var e=0,r=0;r<t.length;){for(var n=r+1;n<t.length;){var o=t[r],i=t[n];if(o.getLastNodeId()==i.getFirstNodeId());else if(o.getLastNodeId()==i.getLastNodeId())i.reversePosOrder();else if(o.getFirstNodeId()==i.getFirstNodeId())o.reversePosOrder();else{if(o.getFirstNodeId()!=i.getLastNodeId()){n++;continue}o.reversePosOrder(),i.reversePosOrder()}o.includePathOrder(i,0),t[r]=o,t.splice(n,1),e++}r++}return e},c=u();c>0;)c=u();for(var f=0;f<t.length;)t[f].pos_order.length<r?t.splice(f,1):f++;if(n>0)for(var p=function(e){var r=t[e].pos_order.length-1;t[e].pos_order=t[e].pos_order.filter((function(t,e){return e%n==0||e==r}))},g=0;g<t.length;g++)p(g);return t}();for(var l=[],h=0;h<a.length;h++){var d=o(s.gis_info,s.unit_id,a[h]).coordinates;if(!(d.length<r)){var u=s.parseCoordinates(d);l.push(u)}}return l},this.parseCoordinates=function(t){for(var e=new A("path"),r=0;r<t.length;r++){var n=t[r],o=new z.A(n[0]),i=new z.A(n[1]),a=o.times(V).div(J).toNumber(),s=i.times(V).div($).toNumber(),l=o.times(V).dp(0).toString()+"p"+i.times(V).dp(0).toString();e.pushPosIds(l),e.pushCoordinateId(l,a,s)}return e},this.edit_data=t,this.gis_info=e,this.layer_uuid=r,this.unit_id=n,this.unit_type=a};const W=Q;var Z=function(t,e,r,n,a){var s=this;this.generatePath=function(){var t=s.edit_data.layers[s.layer_uuid],e="ok"==t.layer_infomation.path_join,r=Number(t.layer_infomation.threshold),n=Number(t.layer_infomation.thinoout),a=i(s.gis_info,s.unit_id,{lake:t.layer_infomation.lake});if(e)return function(){for(var t=[],e=0;e<a.length;e++)for(var i=o(s.gis_info,s.unit_id,a[e]),l=s.parseCoordinates(i.coordinates),h=l.pos_order.length,d=0;d<=t.length;d++){if(d>=t.length-1){t.push(l);break}if(t[d].pos_order.length<=h){t.splice(d,0,l);break}}for(var u=function(){for(var e=0,r=0;r<t.length;){for(var n=r+1;n<t.length;){var o=t[r],i=t[n];if(o.getLastNodeId()==i.getFirstNodeId());else if(o.getLastNodeId()==i.getLastNodeId())i.reversePosOrder();else if(o.getFirstNodeId()==i.getFirstNodeId())o.reversePosOrder();else{if(o.getFirstNodeId()!=i.getLastNodeId()){n++;continue}o.reversePosOrder(),i.reversePosOrder()}o.includePathOrder(i,0),t[r]=o,t.splice(n,1),e++}r++}return e},c=u();c>0;)c=u();for(var f=0;f<t.length;)t[f].pos_order.length<r?t.splice(f,1):f++;if(n>0)for(var p=function(e){var r=t[e].pos_order.length-1;t[e].pos_order=t[e].pos_order.filter((function(t,e){return e%n==0||e==r}))},g=0;g<t.length;g++)p(g);return t}();for(var l=[],h=0;h<a.length;h++){var d=o(s.gis_info,s.unit_id,a[h]).coordinates;if(!(d.length<r)){var u=s.parseCoordinates(d);l.push(u)}}return l},this.parseCoordinates=function(t){for(var e=new A("path"),r=0;r<t.length;r++){var n=t[r],o=new z.A(n[0]),i=new z.A(n[1]),a=o.times(V).div(J).toNumber(),s=i.times(V).div($).toNumber(),l=o.times(V).dp(0).toString()+"p"+i.times(V).dp(0).toString();e.pushPosIds(l),e.pushCoordinateId(l,a,s)}return e},this.edit_data=t,this.gis_info=e,this.layer_uuid=r,this.unit_id=n,this.unit_type=a};const tt=Z;const et=function(){var t=this;this.pushNode=function(e){return t.svg_tree.push(e),t.svg_tree.length-1},this.pushChild=function(e,r){t.svg_tree[e].linkChild(r)},this.svg_tree=[]};var rt=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,i=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a},nt=function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))},ot=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},it=function(t,e){var r=this;this.parser=function(){for(var t=r.edit_data.layers_order,e=0;e<t.length;e++)r.parserLayer(t[e])},this.getLayerName=function(t){var e=r.edit_data.layers[t],n=e.unit_id;switch(r.gis_info.id_type[n]){case"RailroadSection":return"鉄道_"+e.layer_infomation.railway+"_"+e.layer_infomation.line;case"Station":return"駅_"+e.layer_infomation.railway+"_"+e.layer_infomation.line;case"Coast":return"海岸線_"+e.layer_infomation.pref;case"Lake":return"湖_"+e.layer_infomation.lake}return"不明"},this.parserLayer=function(t){var e,n=r.edit_data.layers[t].unit_id,o=(r.gis_info.id_type[n],r.switchParserLayer(t));r.graph_coordinate_dict[r.getLayerName(t)]?(e=r.graph_coordinate_dict[r.getLayerName(t)]).push.apply(e,nt([],rt(o),!1)):r.graph_coordinate_dict[r.getLayerName(t)]=o},this.toSVGPoint=function(t,e){for(var n=e.pos_order,o=e.coordinates,i=0;i<n.length;i++){var s=o.get(n[i]),l=new a;l.setTag("circle"),l.pushAttributeNum("cx",s.x),l.pushAttributeNum("cy",s.y),l.pushAttributeNum("r",4),l.pushAttribute("stroke","none"),l.pushAttribute("stroke-width","0"),l.pushAttribute("fill","black");var h=r.svg_kit.pushNode(l);r.svg_kit.pushChild(0,h),t.linkChild(h)}},this.toSVGPath=function(t,e){var o=e.pos_order,i=new a,s=e.coordinates;i.pushComment(String(e.coordinate_expression_id)),i.setTag("path");var l="rgb("+String(n(50,200))+","+String(n(50,200))+","+String(n(50,200))+")";i.pushAttribute("stroke",l),i.pushAttribute("stroke-width","2"),i.pushAttribute("fill","none");var h=s.get(o[0]);i.pushSvgCommand("M",h.x,h.y);for(var d=0;d<o.length;d++){var u=s.get(o[d]);i.pushSvgCommand("L",u.x,u.y)}var c=r.svg_kit.pushNode(i);t.linkChild(c)},this.toSVG=function(){for(var t=Object.keys(r.graph_coordinate_dict),e=0;e<t.length;e++){var n=t[e],o=r.graph_coordinate_dict[n],i=new a;i.setTag("g"),i.pushAttribute("id",n);var s=r.svg_kit.pushNode(i);r.svg_kit.pushChild(0,s);for(var l=0;l<o.length;l++){var h=o[l];h.coordinates,0!=h.pos_order.length&&("path"==h.getType()&&r.toSVGPath(i,h),"point"==h.getType()&&r.toSVGPoint(i,h))}}return r.svg_kit.svg_tree[0].generate(r.svg_kit.svg_tree)},this.scaling=function(){var t=r.searchCoordinateLeftTop(),e=r.searchCoordinateRightBottom();r.moveCoordinateOrigin(t);var n={x:e.x-t.x,y:e.y-t.y},o=(0,z.A)(r.edit_data.width).div((0,z.A)(n.x)).toNumber(),i=(0,z.A)(r.edit_data.height).div((0,z.A)(n.y)).toNumber(),a=Math.min(o,i);r.moveCoordinateReduction(a),r.invertedCoordinate(),r.moveCoordinateOrigin(r.searchCoordinateLeftTop()),r.decimalPlaceRound()},this.decimalPlaceRound=function(){for(var t,e,n=Object.values(r.graph_coordinate_dict).flat(),o=0;o<n.length;o++){var i=n[o],a=i.coordinates;i.pos_order;try{for(var s=(t=void 0,ot(a.values())),l=s.next();!l.done;l=s.next()){var h=l.value;h.x=(0,z.A)(h.x).dp(r.edit_data.decimal_place).toNumber(),h.y=(0,z.A)(h.y).dp(r.edit_data.decimal_place).toNumber()}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}}},this.invertedCoordinate=function(){for(var t,e,n=Object.values(r.graph_coordinate_dict).flat(),o=0;o<n.length;o++){var i=n[o],a=i.coordinates;i.pos_order;try{for(var s=(t=void 0,ot(a.values())),l=s.next();!l.done;l=s.next()){var h=l.value;h.y=(0,z.A)(r.edit_data.height).minus((0,z.A)(h.y)).toNumber()}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}}},this.moveCoordinateReduction=function(t){for(var e,n,o=Object.values(r.graph_coordinate_dict).flat(),i=0;i<o.length;i++){var a=o[i],s=a.coordinates;a.pos_order;try{for(var l=(e=void 0,ot(s.values())),h=l.next();!h.done;h=l.next()){var d=h.value;d.x=(0,z.A)(d.x).times((0,z.A)(t)).toNumber(),d.y=(0,z.A)(d.y).times((0,z.A)(t)).toNumber()}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}}},this.moveCoordinateOrigin=function(t){for(var e,n,o=Object.values(r.graph_coordinate_dict).flat(),i=0;i<o.length;i++){var a=o[i],s=a.coordinates;a.pos_order;try{for(var l=(e=void 0,ot(s.values())),h=l.next();!h.done;h=l.next()){var d=h.value;d.x=d.x-t.x,d.y=d.y-t.y}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}}},this.searchCoordinateLeftTop=function(){for(var t,e,n=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,i=Object.values(r.graph_coordinate_dict).flat(),a=0;a<i.length;a++){var s=i[a],l=s.coordinates;s.pos_order;try{for(var h=(t=void 0,ot(l.values())),d=h.next();!d.done;d=h.next()){var u=d.value;n>u.x&&(n=u.x),o>u.y&&(o=u.y)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}}return{x:n,y:o}},this.searchCoordinateRightBottom=function(){for(var t,e,n=Number.MIN_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,i=Object.values(r.graph_coordinate_dict).flat(),a=0;a<i.length;a++){var s=i[a],l=s.coordinates;s.pos_order;try{for(var h=(t=void 0,ot(l.values())),d=h.next();!d.done;d=h.next()){var u=d.value;n<u.x&&(n=u.x),o<u.y&&(o=u.y)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}}return{x:n,y:o}},this.switchParserLayer=function(t){var e=r.edit_data.layers[t].unit_id,n=r.gis_info.id_type[e];switch(n){case"RailroadSection":return(i=new H(r.edit_data,r.gis_info,t,e,n)).coordinateAggregation(),i.generatePath();case"Station":var o=new Y(r.edit_data,r.gis_info,t,e,n);return o.coordinateAggregation(),o.generatePoint();case"Coast":return(i=new W(r.edit_data,r.gis_info,t,e,n)).generatePath();case"Lake":var i;return(i=new tt(r.edit_data,r.gis_info,t,e,n)).generatePath()}},this.edit_data=t,this.gis_info=e,this.svg_kit=new et,this.graph_coordinate_dict={};var o=new a;o.setTag("svg"),o.pushAttribute("xmlns","http://www.w3.org/2000/svg"),o.pushAttributeNum("width",t.width),o.pushAttributeNum("height",t.height),this.svg_kit.pushNode(o)};const at=it;self.addEventListener("message",(function(t){var e=new at(t.data.edit_data,t.data.gis_info);e.parser(),e.scaling();var r=e.toSVG();self.postMessage(r)}),!1)}},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={id:t,loaded:!1,exports:{}};return r[t].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=r,o.x=()=>{var t=o.O(void 0,[188],(()=>o(628)));return t=o.O(t)},t=[],o.O=(e,r,n,i)=>{if(!r){var a=1/0;for(d=0;d<t.length;d++){for(var[r,n,i]=t[d],s=!0,l=0;l<r.length;l++)(!1&i||a>=i)&&Object.keys(o.O).every((t=>o.O[t](r[l])))?r.splice(l--,1):(s=!1,i<a&&(a=i));if(s){t.splice(d--,1);var h=n();void 0!==h&&(e=h)}}return e}i=i||0;for(var d=t.length;d>0&&t[d-1][2]>i;d--)t[d]=t[d-1];t[d]=[r,n,i]},o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,r)=>(o.f[r](t,e),e)),[])),o.u=t=>t+".js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={628:1};o.f.i=(e,r)=>{t[e]||importScripts(o.p+o.u(e))};var e=self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[],r=e.push.bind(e);e.push=e=>{var[n,i,a]=e;for(var s in i)o.o(i,s)&&(o.m[s]=i[s]);for(a&&a(o);n.length;)t[n.pop()]=1;r(e)}})(),e=o.x,o.x=()=>o.e(188).then(e);o.x()})();