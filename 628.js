(()=>{"use strict";var t,e,r={628:(t,e,r)=>{var n=r(446),i=r(53),o=r(466),a=r(443),s=r(316),l=r(975),d=r(981),h=r(185),u={units:{},gis_data:{},id_type:{}},c=!1,f=function(){return c?u:function(){var t=n,e=i,r=o,f=a,p=s,g=l,_=[];_=_.concat(d);var v={type:"FeatureCollection",name:"lake-05",features:h},y={type:"FeatureCollection",name:"Hokkaido_23_Coast",features:_};return u.gis_data["2005_rail"]=t,u.units["2005_rail"]={unit_id:"2005_rail",name:"2005年路線データ",grouping_size:2},u.gis_data["2005_station"]=f,u.units["2005_station"]={unit_id:"2005_station",name:"2005年駅データ",grouping_size:2},u.gis_data["2022_rail"]=e,u.units["2022_rail"]={unit_id:"2022_rail",name:"2022年路線データ",grouping_size:2},u.gis_data["2022_station"]=p,u.units["2022_station"]={unit_id:"2022_station",name:"2022年駅データ",grouping_size:2},u.gis_data["2023_rail"]=r,u.units["2023_rail"]={unit_id:"2022_rail",name:"2023年路線データ",grouping_size:2},u.gis_data["2023_station"]=g,u.units["2023_station"]={unit_id:"2023_station",name:"2023年駅データ",grouping_size:2},u.gis_data["2023_coast"]=y,u.units["2023_coast"]={unit_id:"2023_coast",name:"2023年海岸線データ",grouping_size:2},u.gis_data["2005_lake"]=v,u.units["2005_lake"]={unit_id:"2005_lake",name:"2005年湖沼データ",grouping_size:2},u.id_type["2005_rail"]="RailroadSection",u.id_type["2005_station"]="Station",u.id_type["2022_rail"]="RailroadSection",u.id_type["2022_station"]="Station",u.id_type["2023_rail"]="RailroadSection",u.id_type["2023_station"]="Station",u.id_type["2005_lake"]="Lake",u.id_type["2023_coast"]="Coast",c=!0,u}()};function p(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t)+t)}var g=function(t,e){return f().gis_data[t].features[e].geometry},_=function(t,e){for(var r=f().gis_data[t],n=[],i=0;i<r.features.length;i++){for(var o=r.features[i].properties,a=Object.keys(e),s=!0,l=0;l<a.length;l++){var d=a[l],h=e[d];if(o[d]!=h){s=!1;break}}s&&n.push(i)}return n};const v=function(){var t=this;this.generate=function(e){return t.generateComment()+" "+t.generateStartTag()+" "+t.generateElementTag()+" "+t.generateChildren(e)+" "+t.generateEndTag()+" "},this.pushSvgCommand=function(e,r,n){var i={command:e,x:String(r),y:String(n)};t.svg_command.push(i)},this.setTag=function(e){t.tag=e},this.setElement=function(e){t.element=e},this.linkChild=function(e){t.children.push(e)},this.pushAttribute=function(e,r){t.attributes[e]=r},this.pushComment=function(e){t.svg_comment.push(e)},this.pushAttributeNum=function(e,r){t.attributes[e]=r.toString()},this.generateSvgCommand=function(){if(0==t.svg_command.length)return"";var e="";e+='d="';for(var r=0;r<t.svg_command.length;r++){var n=t.svg_command[r],i=" ";i+=n.command,"none"!=n.x&&(i+=" ",i+=n.x),"none"!=n.y&&(i+=" ",i+=n.y),e+=i}return e+='"'},this.generateStartTag=function(){return"<"+t.tag+" "+t.generateAttributeTag()+" "+t.generateSvgCommand()+" >"},this.generateElementTag=function(){return t.element},this.generateEndTag=function(){return"</"+t.tag+">"},this.generateComment=function(){for(var e="",r=0;r<t.svg_comment.length;r++)e+="\x3c!--"+t.svg_comment[r]+"--\x3e\n";return e},this.generateChildren=function(e){for(var r=" ",n=0;n<t.children.length;n++)r+=e[t.children[n]].generate(e),r+=" ";return r},this.generateAttributeTag=function(){for(var e="",r=Object.keys(t.attributes),n=0;n<r.length;n++){var i=r[n];e+=" "+i+' = "'+t.attributes[i]+'" '}return e},this.tag="",this.children=[],this.element="",this.attributes={},this.svg_command=[],this.svg_comment=[]};var y=function(t,e,r){var n=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/(x(t,e)*x(t,r));return Math.acos(n)},m=function(t,e){var r=e.x-t.x,n=e.y-t.y;return Math.pow(r,2)+Math.pow(n,2)},x=function(t,e){var r=e.x-t.x,n=e.y-t.y,i=Math.pow(r,2)+Math.pow(n,2);return Math.sqrt(i)},b=y({x:0,y:0},{x:1,y:0},{x:0,y:1}),w=function(t){return Object.assign(Object.create(Object.getPrototypeOf(t)),t)},k=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},N=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};const P=function(){var t=this;this.pushNode=function(e){if(t.graph.has(e.node_id)){for(var r=t.graph.get(e.node_id),n=0;n<e.bidirectional_link_id_list.length;n++){var i=e.bidirectional_link_id_list[n];r.pushBidirectionalLinkNode(i)}t.graph.set(e.node_id,r)}else t.graph.set(e.node_id,e);for(n=0;n<e.bidirectional_link_id_list.length;n++){var o=e.bidirectional_link_id_list[n],a=t.graph.get(o);a.pushBidirectionalLinkNode(e.node_id),t.graph.set(o,a)}},this.getTerminationPointID=function(){if(0==t.graph.size)return[];for(var e=[],r=1;0==e.length;)e=t.getPointID(r),r++;return e},this.getOddBranchPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),i=0;i<n.length;i++){var o=n[i],a=t.graph.get(o);a.bidirectional_link_id_list.length%2==1&&a.bidirectional_link_id_list.length>=3&&e.push(o)}return e},this.getEvenBranchPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),i=0;i<n.length;i++){var o=n[i],a=t.graph.get(o);a.bidirectional_link_id_list.length%2==0&&a.bidirectional_link_id_list.length>=4&&e.push(o)}return e},this.getOddPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),i=0;i<n.length;i++){var o=n[i];t.graph.get(o).bidirectional_link_id_list.length%2!=1||e.push(o)}return e},this.getEvenPointID=function(){for(var e=[],r=t.graph.keys(),n=Array.from(r),i=0;i<n.length;i++){var o=n[i];t.graph.get(o).bidirectional_link_id_list.length%2!=0||e.push(o)}return e},this.getPointID=function(e){for(var r=[],n=t.graph.keys(),i=Array.from(n),o=0;o<i.length;o++){var a=i[o];t.graph.get(a).bidirectional_link_id_list.length!=e||r.push(a)}return r},this.deleteLinkNode=function(e,r){var n=t.graph.get(e);n.bidirectional_link_id_list=n.bidirectional_link_id_list.filter((function(t,e){return t!=r}))},this.replaceLinkNode=function(e,r,n){for(var i=t.graph.get(e),o=0;o<i.bidirectional_link_id_list.length;o++)i.bidirectional_link_id_list[o]==r&&(i.bidirectional_link_id_list[o]=n)},this.separationLinkNode=function(e,r,n){var i=t.graph.get(e),o=i.copyGraphNode(),a=i.copyGraphNode();o.bidirectional_link_id_list=N([],k(r),!1),a.bidirectional_link_id_list=i.bidirectional_link_id_list.filter((function(t){return!r.includes(t)}));var s=i.node_id,l=s+n;o.node_id=l,t.graph.set(o.node_id,o),t.graph.set(a.node_id,a);for(var d=0;d<r.length;d++)t.replaceLinkNode(r[d],s,l);return l},this.intersectionExtraction=function(){for(var e=[],r=function(e){for(var r=t.graph.get(e),n=r.bidirectional_link_id_list,i=Number.MIN_SAFE_INTEGER,o=[],a=0;a<n.length;a++)for(var s=n[a],l=t.graph.get(s),d=a+1;d<n.length;d++){var h=n[d],u=t.graph.get(h),c=y({x:r.x,y:r.y},{x:l.x,y:l.y},{x:u.x,y:u.y});i<c&&(i=c,o=[s,h])}return o},n=function(e,r){var n=t.graph.get(e),i=n.bidirectional_link_id_list.filter((function(t,e){return!r.includes(t)}));if(2!=i.length)return!1;var o=t.graph.get(i[0]),a=t.graph.get(i[1]);return y({x:n.x,y:n.y},{x:o.x,y:o.y},{x:a.x,y:a.y})<=b},i=t.getEvenBranchPointID(),o=0;i.length>0;){var a=i[0],s=r(a);n(a,s)?e.push(a):t.separationLinkNode(a,s,"s"+o),o++,i=t.getEvenBranchPointID().filter((function(t,r){return!e.includes(t)}))}},this.loopLinePoint=function(e,r){var n=r[0],i=t.graph.get(n),o=w(i),a=w(i);o.bidirectional_link_id_list=[i.bidirectional_link_id_list[0]],a.bidirectional_link_id_list=[i.bidirectional_link_id_list[1]];var s=a.node_id,l=s+"c";a.node_id=l,t.graph.set(o.node_id,o),t.graph.set(a.node_id,a),t.replaceLinkNode(i.bidirectional_link_id_list[1],s,l)},this.graph=new Map};var S=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},C=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))};const I=function t(){var e=this;this.copyGraphNode=function(){var r=new t;return r.x=e.x,r.y=e.y,r.node_id=e.node_id,r.bidirectional_link_id_list=C([],S(e.bidirectional_link_id_list),!1),r},this.pushBidirectionalLinkNode=function(t){e.bidirectional_link_id_list.push(t)},this.setId=function(t){e.node_id=t},this.setIdByPos=function(t,r){var n=t+"p"+r;e.node_id=n},this.setX=function(t){e.x=t},this.setY=function(t){e.y=t},this.setPos=function(t,r){e.x=t,e.y=r},this.getPos=function(){return{x:e.x,y:e.y}},this.node_id="",this.x=0,this.y=0,this.bidirectional_link_id_list=[]};var A=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const E=function(){var t=this;this.getPaths=function(e){return t.node_paths.has(e)?t.node_paths.get(e):[]},this.isValidNode=function(e){var r,n;if(!t.node_paths.has(e))return!1;var i=t.node_paths.get(e);try{for(var o=A(i),a=o.next();!a.done;a=o.next())if(a.value>=0)return!0}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},this.otheGroupPath=function(e,r){var n,i,o,a;if(!t.node_paths.has(e))return-1;if(!t.node_paths.has(r))return-1;var s=t.node_paths.get(e),l=t.node_paths.get(r);try{for(var d=A(s),h=d.next();!h.done;h=d.next()){var u=h.value;try{for(var c=(o=void 0,A(l)),f=c.next();!f.done;f=c.next())if(u==f.value)return u}catch(t){o={error:t}}finally{try{f&&!f.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}}}catch(t){n={error:t}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return-1},this.pushNode=function(e,r){if(t.node_paths.has(e)){var n=t.node_paths.get(e);n.push(r),t.node_paths.set(e,n)}else t.node_paths.set(e,[r])},this.node_paths=new Map};var O=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},L=function(){var t=this;this.pushArrivedNode=function(e){t.arrived_nodes.push(e)},this.isArrivedNode=function(e){return t.arrived_nodes.includes(e)},this.includeArrivedNode=function(e){var r=[];r=(r=r.concat(t.arrived_nodes)).concat(e.arrived_nodes),t.arrived_nodes=r},this.setCoordinateExpressionId=function(e){t.coordinate_expression_id=e},this.getCoordinateExpressionId=function(){return t.coordinate_expression_id},this.hasCoordinateExpressionId=function(){return t.coordinate_expression_id>=0},this.includeRoute=function(e){var r=[];r=(r=r.concat(t.routes)).concat(e.routes),t.routes=r},this.replaceRoute=function(e){t.routes=[],t.routes=t.routes.concat(e)},this.pushRoute=function(e){t.routes.push(e)},this.pushRoutes=function(e){var r,n;try{for(var i=O(e),o=i.next();!o.done;o=i.next()){var a=o.value;t.routes.push(a)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},this.setDistance=function(e){t.distance=e},this.distance=-1,this.routes=[],this.coordinate_expression_id=-1,this.arrived_nodes=[]};const j=L;var T=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const R=function(){var t=this;this.getOddBranch=function(){var e,r,n=[];try{for(var i=T(t.route.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;t.route.get(a).size%2==1&&n.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},this.getBranch=function(e){var r,n,i=[];try{for(var o=T(t.route.keys()),a=o.next();!a.done;a=o.next()){var s=a.value;t.route.get(s).size==e&&i.push(s)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},this.getTerminal=function(){var e,r,n=[];try{for(var i=T(t.route.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;1==t.route.get(a).size&&n.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},this.getBranchNodes=function(){var e,r,n=[];try{for(var i=T(t.route.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;t.route.get(a).size>=3&&n.push(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},this.getNodeKeys=function(){return t.route.keys()},this.getNodeKeysList=function(){return Array.from(t.route.keys())},this.getPathContacts=function(e,r){if(!t.route.has(e))return[];var n=t.route.get(e);return n.has(r)?n.get(r):[]},this.hasPathContact=function(e,r){if(!t.route.has(e))return!1;var n=t.route.get(e);return!!n.has(r)&&0!=n.get(r).length},this.getSortPathContact=function(e,r,n){if(!t.route.has(r))return[];var i,o,a=t.route.get(r);if(!a.has(n))return[];var s=a.get(n);return e?(i=-1,o=1):(i=1,o=-1),s.sort((function(t,e){var r=t,n=e;return r.distance>n.distance?i:r.distance<n.distance?o:0})),s},this.getAllSortPathContact=function(e){var r,n,i=t.getAllPathContact();return e?(r=-1,n=1):(r=1,n=-1),i.sort((function(t,e){var i=t,o=e;return i.distance>o.distance?r:i.distance<o.distance?n:0})),i},this.getAllPathContact=function(){var e,r,n,i,o=[];try{for(var a=T(t.route.keys()),s=a.next();!s.done;s=a.next()){var l=s.value,d=t.route.get(l);try{for(var h=(n=void 0,T(d.keys())),u=h.next();!u.done;u=h.next()){var c=u.value,f=d.get(c);o=o.concat(f)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return o},this.getPathContact=function(e,r){return t.route.get(e).get(r)[0]},this.getMinPathContact=function(e,r){for(var n,i=t.route.get(e).get(r),o=Number.MAX_SAFE_INTEGER,a=0;a<i.length;a++)o>i[a].distance&&(n=i[a]);return n},this.buildNextPaths=function(e){var r,n,i,o;try{for(var a=T(e),s=a.next();!s.done;s=a.next()){var l=s.value,d=new Map;try{for(var h=(i=void 0,T(e)),u=h.next();!u.done;u=h.next()){var c=u.value;l!=c&&d.set(c,[])}}catch(t){i={error:t}}finally{try{u&&!u.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}t.route.set(l,d)}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}},this.buildPaths=function(e){for(var r=e.length,n=0;n<r;n++){for(var i=e[n],o=new Map,a=0;a<r;a++){var s=e[a];if(n!=a)o.set(s,[]);else{var l=new j;l.setDistance(-1),l.coordinate_expression_id=-2,o.set(s,[l])}}t.route.set(i,o)}},this.setSemiRoute=function(e,r,n){if(!t.route.has(e)){var i=new Map;t.route.set(e,i)}var o=t.route.get(e),a=[n];o.set(r,a),t.route.set(e,o)},this.pushSemiRoute=function(e,r,n){if(!t.route.has(e)){var i=new Map;t.route.set(e,i)}var o=t.route.get(e);o.has(r)||o.set(r,[]);var a=o.get(r);a.push(n),o.set(r,a),t.route.set(e,o)},this.pushRoute=function(e,r,n){if(!t.route.has(e)){var i=new Map;t.route.set(e,i)}t.route.has(r)||(i=new Map,t.route.set(r,i));var o=t.route.get(e),a=t.route.get(r);if(!o.has(r)){var s=[];o.set(r,s)}a.has(e)||(s=[],a.set(e,s));var l=o.get(r),d=a.get(e);l.push(n),d.push(n),o.set(r,l),a.set(e,d),t.route.set(e,o),t.route.set(r,a)},this.pushRoutes=function(e,r,n){var i,o;try{for(var a=T(n),s=a.next();!s.done;s=a.next()){var l=s.value;t.pushRoute(e,r,l)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}},this.route=new Map};var M=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const D=function(){var t=this;this.generateNext=function(t){var e,r,n=new R;try{for(var i=M(t.path.values()),o=i.next();!o.done;o=i.next()){var a=o.value,s=a.getDistance(),l=a.getFirstNodeId(),d=a.getLastNodeId(),h=new j;h.setDistance(s),h.pushRoute(a.coordinate_expression_id),h.setCoordinateExpressionId(a.coordinate_expression_id),n.pushRoute(l,d,h)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},this.generateRouteHalf=function(e,r,n){var i=new R;return i=t.extractionEnumeration(e,r,i,n)},this.generateRoute=function(e,r){var n,i,o=new R;try{for(var a=M(e.graph.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;o=t.extractionEnumeration(e,r,o,l)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},this.generateRouteShortest=function(e,r){var n,i,o=new R;try{for(var a=M(e.graph.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;o=t.extractionGraphDetermination(e,r,o,l)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o},this.generateGraphExtraction=function(t,e){var r,n,i=new P;try{for(var o=M(e.path.values()),a=o.next();!a.done;a=o.next()){var s=a.value,l=(s.getDistance(),s.getFirstNodeId()),d=s.getLastNodeId(),h=t.graph.get(l),u=t.graph.get(d),c=new I;c.setPos(h.x,h.y),c.setId(l),i.pushNode(c);var f=new I;f.setPos(u.x,u.y),f.setId(d),f.pushBidirectionalLinkNode(l),i.pushNode(f)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i},this.extractionGraphDetermination=function(t,e,r,n){var i,o,a,s,l,d=[],h=new Map,u=function(t){return d.push(t)-1};u(n);try{for(var c=M(t.graph.keys()),f=c.next();!f.done;f=c.next()){var p=f.value;h.set(p,Number.MAX_SAFE_INTEGER)}}catch(t){i={error:t}}finally{try{f&&!f.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}for(h.set(n,0);d.length>0;){var g=(l=void 0,l=d[0],d.shift(),l),_=t.graph.get(g).bidirectional_link_id_list;try{for(var v=(a=void 0,M(_)),y=v.next();!y.done;y=v.next()){var m=y.value;if(g!=m&&n!=m){var x=e.getMinPathContact(g,m),b=x.distance+h.get(g),w=h.get(m);if(!(w<=b)){w>b&&(h.set(m,b),u(m));var k=new j;if(k.setDistance(b),k.setCoordinateExpressionId(-3),r.hasPathContact(n,g)){var N=r.getMinPathContact(n,g);k.includeRoute(N)}k.pushRoute(x.coordinate_expression_id),r.setSemiRoute(n,m,k)}}}}catch(t){a={error:t}}finally{try{y&&!y.done&&(s=v.return)&&s.call(v)}finally{if(a)throw a.error}}}return r},this.extractionEnumeration=function(t,e,r,n){var i=function(o,a,s){var l,d,h,u,c,f,p,g,_=o[o.length-1],v=t.graph.get(_).bidirectional_link_id_list;if(o.length<2)try{for(var y=M(v),m=y.next();!m.done;m=y.next()){var x=m.value,b=e.getPathContacts(_,x);try{for(var w=(h=void 0,M(b)),k=w.next();!k.done;k=w.next()){var N=k.value;(L=o).push(x),(T=a).push(N.coordinate_expression_id),i(L,T,N.distance),L.pop(),T.pop()}}catch(t){h={error:t}}finally{try{k&&!k.done&&(u=w.return)&&u.call(w)}finally{if(h)throw h.error}}}}catch(t){l={error:t}}finally{try{m&&!m.done&&(d=y.return)&&d.call(y)}finally{if(l)throw l.error}}else{o[o.length-2];var P=new j;P.setCoordinateExpressionId(-3),P.setDistance(s),P.pushRoutes(a),r.pushSemiRoute(n,_,P);try{for(var S=M(v),C=S.next();!C.done;C=S.next()){x=C.value;var I=e.getPathContacts(_,x);try{for(var A=(p=void 0,M(I)),E=A.next();!E.done;E=A.next()){var O=E.value;if(!a.includes(O.coordinate_expression_id)){var L,T;(L=o).push(x),(T=a).push(O.coordinate_expression_id);var R=s+O.distance;i(L,T,R),L.pop(),T.pop()}}}catch(t){p={error:t}}finally{try{E&&!E.done&&(g=A.return)&&g.call(A)}finally{if(p)throw p.error}}}}catch(t){c={error:t}}finally{try{C&&!C.done&&(f=S.return)&&f.call(S)}finally{if(c)throw c.error}}}};return i([n],[],0),r}};var F=r(543),G=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const z=function(t){var e=this;this.includePathOrder=function(t,r){F.cloneDeep(e.pos_order);var n,i,o=t.pos_order.filter((function(t,e){return e>=r}));e.pos_order=e.pos_order.concat(o);try{for(var a=G(t.coordinates.keys()),s=a.next();!s.done;s=a.next()){var l=s.value;e.coordinates.set(l,t.coordinates.get(l))}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}},this.includePath=function(t){var r,n;e.pos_order=e.pos_order.concat(t.pos_order);try{for(var i=G(t.coordinates.keys()),o=i.next();!o.done;o=i.next()){var a=o.value;e.coordinates.set(a,t.coordinates.get(a))}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},this.setCoordinateExpressionId=function(t){e.coordinate_expression_id=t},this.reversePosOrder=function(){e.pos_order=e.pos_order.reverse()},this.getDistance=function(){for(var t=0,r=1;r<e.pos_order.length;r++){var n=e.coordinates.get(e.pos_order[r-1]),i=e.coordinates.get(e.pos_order[r]);t+=x(n,i)}return t},this.getFirstNodeId=function(){return e.pos_order[0]},this.getLastNodeId=function(){return e.pos_order[e.pos_order.length-1]},this.pushDebugMessage=function(t,r){e.debug_message.push(t+" x:"+String(r.x)+" y: "+String(r.y))},this.getType=function(){return e.type},this.pushPosIdsIndex=function(t,r){e.pos_order.splice(r,0,t)},this.pushPosIds=function(t){e.pos_order.push(t)},this.pushCoordinateId=function(t,r,n){e.coordinates.set(t,{x:r,y:n}),e.pushPosIds(t)},this.coordinates=new Map,this.type=t,this.debug_message=[],this.pos_order=[]};const B=function(){var t=this;this.getJoinPathCoordinateFlag=function(t,e){if(t.length<2)return[-1,-1];if(e.length<2)return[-1,-1];var r=function(){return t[0]},n=function(){return t[t.length-1]},i=function(){return e[0]},o=function(){return e[e.length-1]};return n()==i()?[0,0]:n()==o()?[0,1]:r()==i()?[1,0]:r()==o()?[1,1]:[-1,-1]},this.getJoinPathFlag=function(e,r){var n=t.path.get(e),i=t.path.get(r);return n.getLastNodeId()==i.getFirstNodeId()?[0,0]:n.getLastNodeId()==i.getLastNodeId()?[0,1]:n.getFirstNodeId()==i.getFirstNodeId()?[1,0]:n.getFirstNodeId()==i.getLastNodeId()?[1,1]:[-1,-1]},this.joinPath=function(e,r){var n=t.path.get(e),i=t.path.get(r);if(n.getLastNodeId()==i.getFirstNodeId());else if(n.getLastNodeId()==i.getLastNodeId())i.reversePosOrder();else if(n.getFirstNodeId()==i.getFirstNodeId())n.reversePosOrder();else{if(n.getFirstNodeId()!=i.getLastNodeId())return!1;n.reversePosOrder(),i.reversePosOrder()}return n.includePathOrder(i,0),t.path.delete(i.coordinate_expression_id),t.path.set(n.coordinate_expression_id,n),!0},this.isAdjoinProcessed=function(e,r,n){for(var i=t.path.get(e),o=-100,a=-102,s=0;s<i.pos_order.length;s++)r==i.pos_order[s]&&(o=s),n==i.pos_order[s]&&(a=s);return 1==Math.abs(o-a)},this.pushProcessed=function(){var e=new z("path"),r=t.path.size;return e.setCoordinateExpressionId(r),t.path.set(r,e),r},this.pushProcessedPos=function(e,r,n){var i=t.pushProcessed(),o=t.path.get(i);return o.pushCoordinateId(e,r,n),t.path.set(i,o),i},this.pushCoordinateId=function(e,r,n,i){var o=t.path.get(e);o.pushCoordinateId(r,n,i),t.path.set(e,o)},this.path=new Map};var q=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},V=function(t,e){var r=this;this.getProcessedPath=function(){return r.processed_path},this.debugNode=function(){var t,e,n=r.graph_container.graph.keys();try{for(var i=q(n),o=i.next();!o.done;o=i.next())for(var a=o.value,s=r.graph_container.graph.get(a),l=0;l<s.bidirectional_link_id_list.length;l++){var d=s.bidirectional_link_id_list[l];r.graph_container.graph.get(d),r.processed_path.pushProcessed()}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},this.startCalc=function(){r.graph_container.intersectionExtraction(),r.graph_container.graph.keys();var t=r.graph_container.getPointID(1),e=r.graph_container.getPointID(2);0==t.length&&e.length>0&&r.graph_container.loopLinePoint(t,e),r.calcTerminationPoint(),r.original_data_coordinate_correction_flag&&r.reliefSeparate()>0&&(r.node_path=new E,r.processed_path=new B,r.bfs_que=[],r.calcTerminationPoint());for(var n=new D,i=n.generateGraphExtraction(r.graph_container,r.processed_path),o=function(){return i.getPointID(2).filter((function(t,e){return i.graph.get(t).bidirectional_link_id_list[0]==i.graph.get(t).bidirectional_link_id_list[1]}))},a=o();a.length>0;){var s=a[0],l=i.graph.get(s).bidirectional_link_id_list[0],d=(r.graph_container.graph.get(s),r.graph_container.graph.get(l).copyGraphNode()),h=d.node_id+"d";d.node_id=h,d.bidirectional_link_id_list=[s],r.graph_container.graph.set(h,d),r.graph_container.deleteLinkNode(l,s),r.graph_container.replaceLinkNode(s,l,h),r.calcReStart(),i=n.generateGraphExtraction(r.graph_container,r.processed_path),a=o()}},this.calcReStart=function(){r.node_path=new E,r.processed_path=new B,r.bfs_que=[],r.calcTerminationPoint()},this.calcTerminationPoint=function(){for(var t=r.graph_container.getTerminationPointID(),e=0;e<t.length;e++){var n=t[e],i=r.graph_container.graph.get(n);if(!r.isValidNodePath(n)){var o=r.processed_path.pushProcessedPos(n,i.x,i.y);r.node_path.pushNode(n,o),r.dfs(n)}}},this.popDfsStack=function(){var t=r.bfs_que[r.bfs_que.length-1];return r.bfs_que.pop(),t},this.isValidNodePath=function(t){return r.node_path.isValidNode(t)},this.dfs=function(t){var e,n,i,o;r.bfs_que=[],r.bfs_que.push(t);var a=r.graph_container.graph.get(t),s=r.node_path.getPaths(t);try{for(var l=q(s),d=l.next();!d.done;d=l.next()){var h=d.value;r.processed_path.pushCoordinateId(h,t,a.x,a.y)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}for(;r.bfs_que.length>0;){r.bfs_que.length;for(var u=r.popDfsStack(),c=r.graph_container.graph.get(u),f=c.bidirectional_link_id_list,p=f.length,g=r.node_path.getPaths(u),_=0;_<p;_++){var v=f[_],y=r.graph_container.graph.get(v);if(!(r.node_path.otheGroupPath(u,v)>=0)){if(p>=3){var m=r.processed_path.pushProcessedPos(u,c.x,c.y);r.processed_path.pushCoordinateId(m,v,y.x,y.y),r.node_path.pushNode(u,m),r.node_path.pushNode(v,m)}else try{for(var x=(i=void 0,q(g)),b=x.next();!b.done;b=x.next()){var w=b.value;r.processed_path.pushCoordinateId(w,v,y.x,y.y),r.node_path.pushNode(v,w)}}catch(t){i={error:t}}finally{try{b&&!b.done&&(o=x.return)&&o.call(x)}finally{if(i)throw i.error}}r.bfs_que.push(v)}}}},this.reliefSeparateTerminalPoint=function(t){var e,n,i,o,a,s=0,l=r.graph_container.graph.get(t);try{for(var d=q(r.processed_path.path.values()),h=d.next();!h.done;h=d.next()){var u=h.value;if(!u.coordinates.has(t))for(var c=2;c<u.pos_order.length-1;c++){var f=u.pos_order[c-1],p=u.pos_order[c],g=u.coordinates.get(f),_=u.coordinates.get(p),v=m(g,_);if(m(g,{x:l.x,y:l.y})<=v){w(r.graph_container.graph.get(t)),l.bidirectional_link_id_list.includes(f)||l.bidirectional_link_id_list.push(f),l.bidirectional_link_id_list.includes(p)||l.bidirectional_link_id_list.push(p);var y=(i=l.getPos(),o=g,a=_,{x:(i.x+o.x+a.x)/3,y:(i.y+o.y+a.y)/3});return l.setPos(y.x,y.y),r.graph_container.replaceLinkNode(f,p,t),r.graph_container.replaceLinkNode(p,f,t),++s}}}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=d.return)&&n.call(d)}finally{if(e)throw e.error}}return s},this.reliefSeparate=function(){var t,e,n=r.graph_container.getPointID(1),i=0;try{for(var o=q(n),a=o.next();!a.done;a=o.next()){var s=a.value;i+=r.reliefSeparateTerminalPoint(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return i},this.graph_container=t,this.node_path=new E,this.processed_path=new B,this.bfs_que=[],this.original_data_coordinate_correction_flag=e};const J=V;var X=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},$=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},H=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},K=function(){this.getJoinCoordinate=function(t,e){var r,n,i,o;if(0==t.length)return{order:[],coordinates:new Map,joint_index:[]};var a=[],s=new Map,l=[],d=e.path.get(t[0]);a=a.concat(d.pos_order);try{for(var h=X(d.coordinates.keys()),u=h.next();!u.done;u=h.next()){var c=u.value;s.set(c,d.coordinates.get(c))}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}for(var f=1;f<t.length;f++){var p=t[f],g=e.path.get(p),_=H([],$(g.pos_order),!1),v=e.getJoinPathCoordinateFlag(a,_);1==v[0]&&(a=a.reverse()),1==v[1]&&(_=_.reverse());var y=_.filter((function(t,e){return e>0}));l.push(a.length-1),a=a.concat(y);try{for(var m=(i=void 0,X(g.coordinates.keys())),x=m.next();!x.done;x=m.next())c=x.value,s.set(c,g.coordinates.get(c))}catch(t){i={error:t}}finally{try{x&&!x.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}}return{order:a,coordinates:s,joint_index:l}},this.joinLong=function(t){var e,r,n,i=[],o=[],a=function(t){var e,r;try{for(var n=X(t),i=n.next();!i.done;i=n.next()){var a=i.value;if(o.includes(a))return!0}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return!1},s=t.getAllSortPathContact(!0);if(0==s.length)return[];try{for(var l=X(s),d=l.next();!d.done;d=l.next()){var h=d.value;a(h.routes)||(n=h.routes,o=o.concat(n),i.push(h.routes))}}catch(t){e={error:t}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return i},this.joinContinuity=function(t,e){var r,n;try{for(var i=X(t),o=i.next();!o.done;o=i.next())for(var a=o.value,s=a[0],l=1;l<a.length;l++){var d=a[l];e.joinPath(s,d)}}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return e}};const U=K;const Y=function(){var t=this;this.processSharpAngleRemoval=function(t){for(var e=0;e<t.joint_index.length;e++){var r=t.joint_index[e],n=t.order[r-1],i=t.order[r],o=t.order[r+1],a=t.coordinates.get(n),s=t.coordinates.get(i),l=t.coordinates.get(o);if(y(s,a,l)<b)return!0}return!1},this.hasProcessSharpAngleRemovalPath=function(e,r){var n=(new U).getJoinCoordinate(e,r);return t.processSharpAngleRemoval(n)}};var Q=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};const W=function(t,e){var r=this;this.checkDistance=function(t,e){return r.long?t>e:t<e},this.extractionDetermination=function(t,e,n,i,o){var a=null,s=null,l=function(t){return 1e8*t[0]+1e4*t[1]+t[2]},d=function(t){if(t.length<3)return!1;var e=[t[t.length-3],t[t.length-2],t[t.length-1]];if(function(t){return r.sharp_angle_cash.has(l(t))}(e))return function(t){return r.sharp_angle_cash.get(l(t))}(e);var i=(new Y).hasProcessSharpAngleRemovalPath(e,n);return function(t,e){r.sharp_angle_cash.set(l(t),e)}(e,i),i},h=function(n,i,l,u){var c,f,p,g,_,v,y,m,x=n[n.length-1],b=t.graph.get(x).bidirectional_link_id_list;if(n.length<2)try{for(var w=Q(b),k=w.next();!k.done;k=w.next()){var N=k.value,P=e.getPathContacts(x,N);try{for(var S=(p=void 0,Q(P)),C=S.next();!C.done;C=S.next()){var I=C.value;(D=n).push(N),(F=i).push(I.coordinate_expression_id),h(D,F,I.distance,u),D.pop(),F.pop()}}catch(t){p={error:t}}finally{try{C&&!C.done&&(g=S.return)&&g.call(S)}finally{if(p)throw p.error}}}}catch(t){c={error:t}}finally{try{k&&!k.done&&(f=w.return)&&f.call(w)}finally{if(c)throw c.error}}else{var A;if(o==x)if((null==a||r.checkDistance(l,a.distance))&&((A=new j).setCoordinateExpressionId(-3),A.setDistance(l),A.pushRoutes(i),a=A),u&&(d(i)?u=!1:(null==s||r.checkDistance(l,s.distance))&&((A=new j).setCoordinateExpressionId(-3),A.setDistance(l),A.pushRoutes(i),s=A)),!r.long)return;if(o!=x&&u&&d(i)&&(u=!1),!(n.filter((function(t,e){return t==n[n.length-1]&&e<n.length-1})).length>0))try{for(var E=Q(b),O=E.next();!O.done;O=E.next()){N=O.value;var L=e.getPathContacts(x,N);try{for(var T=(y=void 0,Q(L)),R=T.next();!R.done;R=T.next()){var M=R.value;if(!i.includes(M.coordinate_expression_id)){var D,F;(D=n).push(N),(F=i).push(M.coordinate_expression_id);var G=l+M.distance;h(D,F,G,u),D.pop(),F.pop()}}}catch(t){y={error:t}}finally{try{R&&!R.done&&(m=T.return)&&m.call(T)}finally{if(y)throw y.error}}}}catch(t){_={error:t}}finally{try{O&&!O.done&&(v=E.return)&&v.call(E)}finally{if(_)throw _.error}}}};return h([i],[],0,r.sharp_angle_removal_flag),r.sharp_angle_removal_flag&&null!=s?s:a},this.searchDeleteClosedPathShort=function(t,e,n,i){for(var o=(new D).generateRouteShortest(n,i),a=[],s=0;s<t.length;s++){for(var l=t[s],d=s+1;d<t.length;d++){var h=t[d];if(o.hasPathContact(l,h)){var u=o.getMinPathContact(l,h);null!=u&&a.push(u)}}r.keep_paths=r.keep_paths.concat(a)}},this.searchDeleteClosedPathLong=function(t,e,n,i){for(var o=[],a=0;a<t.length;a++){for(var s=t[a],l=a+1;l<t.length;l++){var d=t[l],h=r.extractionDetermination(n,i,e,s,d);null!=h&&o.push(h)}r.keep_paths=r.keep_paths.concat(o)}},this.searchDeleteClosedPath=function(t,e,n,i){r.long?r.searchDeleteClosedPathLong(t,e,n,i):r.searchDeleteClosedPathShort(t,e,n,i)},this.deleteClosedPath=function(t){var e,n,i=function(){var t,e,n=[];try{for(var i=Q(r.keep_paths),o=i.next();!o.done;o=i.next()){var a=o.value;n=n.concat(a.routes)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return n}();try{for(var o=Q(t.path.values()),a=o.next();!a.done;a=o.next()){var s=a.value;i.includes(s.coordinate_expression_id)||t.path.delete(s.coordinate_expression_id)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return t},this.keep_paths=[],this.sharp_angle_removal_flag=t,this.long=e,this.sharp_angle_cash=new Map};var Z=r(346),tt=new Z.A(1e5),et=new Z.A(.010966404715491394),rt=new Z.A(et).times(tt),nt=new Z.A(.0090133729745762),it=(nt.times(tt).div(rt),function(t,e,r,n,i){var o=this;this.pathOptimizeLoop=function(t,e,r,n){var i=new D,o=i.generateNext(r);i=null;var a=!1;2==t&&(a=!0);var s=new W(e,a),l=o.getBranch(1),d=1==l.length,h=d?o.getOddBranch():l;return s.searchDeleteClosedPath(h,r,n,o),r=s.deleteClosedPath(r),o=null,s=null,{branch1_flag:d,grah_paths:r}},this.pathOptimize=function(t,e,r,n){for(var i=10;i>0;){var a=o.pathOptimizeLoop(t,e,r,n);r=a.grah_paths,a.branch1_flag?i--:i=-1}return r},this.pathJoin=function(t,e){var r=new U,n=new D,i=n.generateNext(t),o=n.generateRoute(e,i),a=r.joinLong(o);return t=r.joinContinuity(a,t),r=null,n=null,i=null,o=null,a=null,t},this.generatePath=function(){var t=o.edit_data.layers[o.layer_uuid],e="ok"==t.layer_infomation.path_optimize,r="ok"==t.layer_infomation.path_join,n="ok"==t.layer_infomation.sharp_angle_removal,i="ok"==t.layer_infomation.original_data_coordinate_correction,a=Number(t.layer_infomation.path_optimize_closed_type),s=new J(o.graph,i);s.startCalc();var l=s.getProcessedPath(),d=(new D).generateGraphExtraction(o.graph,l);return e&&(l=o.pathOptimize(a,n,l,d)),r&&(l=o.pathJoin(l,d)),Array.from(l.path.values())},this.coordinateAggregation=function(){for(var t=o.edit_data.layers[o.layer_uuid],e=_(o.unit_id,{N02_004:t.layer_infomation.railway,N02_003:t.layer_infomation.line}),r=0;r<e.length;r++){var n=g(o.unit_id,e[r]).coordinates;o.parseCoordinatesToGraph(n)}},this.parseCoordinatesToGraph=function(t){for(var e="",r=0;r<t.length;r++){var n=t[r],i=new I,a=new Z.A(n[0]),s=new Z.A(n[1]),l=a.times(tt).div(et).toNumber(),d=s.times(tt).div(nt).toNumber(),h=a.times(tt).dp(0).toString(),u=s.times(tt).dp(0).toString();i.setIdByPos(u,h),i.setPos(l,d),r>=1&&i.pushBidirectionalLinkNode(e),o.graph.pushNode(i),e=i.node_id}},this.edit_data=t,this.gis_info=e,this.svg_node=new v,this.layer_uuid=r,this.unit_id=n,this.unit_type=i,this.graph=new P});const ot=it;var at=function(t,e,r,n,i){var o=this;this.generatePoint=function(){return o.points},this.coordinateAggregation=function(){for(var t=o.edit_data.layers[o.layer_uuid],e=_(o.unit_id,{N02_004:t.layer_infomation.railway,N02_003:t.layer_infomation.line}),r=0;r<e.length;r++){var n=g(o.unit_id,e[r]).coordinates;o.parseCoordinates(n)}},this.parseCoordinates=function(t){for(var e=0;e<t.length;e++){var r=t[e],n=new Z.A(r[0]),i=new Z.A(r[1]),a=n.times(tt).div(et).toNumber(),s=i.times(tt).div(nt).toNumber(),l=n.times(tt).dp(0).toString()+"p"+i.times(tt).dp(0).toString(),d=new z("point");d.pushCoordinateId(l,a,s),o.points.push(d)}},this.edit_data=t,this.gis_info=e,this.svg_node=new v,this.layer_uuid=r,this.unit_id=n,this.unit_type=i,this.points=[]};const st=at;var lt=function(t,e,r,n,i){var o=this;this.generatePath=function(){var t=o.edit_data.layers[o.layer_uuid],e="ok"==t.layer_infomation.path_join,r=Number(t.layer_infomation.threshold),n=Number(t.layer_infomation.thinoout),i=_(o.unit_id,{pref:t.layer_infomation.pref});if(e)return function(){for(var t=[],e=0;e<i.length;e++)for(var a=g(o.unit_id,i[e]),s=o.parseCoordinates(a.coordinates),l=s.pos_order.length,d=0;d<=t.length;d++){if(d>=t.length-1){t.push(s);break}if(t[d].pos_order.length<=l){t.splice(d,0,s);break}}for(var h=function(){for(var e=0,r=0;r<t.length;){for(var n=r+1;n<t.length;){var i=t[r],o=t[n];if(i.getLastNodeId()==o.getFirstNodeId());else if(i.getLastNodeId()==o.getLastNodeId())o.reversePosOrder();else if(i.getFirstNodeId()==o.getFirstNodeId())i.reversePosOrder();else{if(i.getFirstNodeId()!=o.getLastNodeId()){n++;continue}i.reversePosOrder(),o.reversePosOrder()}i.includePathOrder(o,0),t[r]=i,t.splice(n,1),e++}r++}return e},u=h();u>0;)u=h();for(var c=0;c<t.length;)t[c].pos_order.length<r?t.splice(c,1):c++;if(n>0)for(var f=function(e){var r=t[e].pos_order.length-1;t[e].pos_order=t[e].pos_order.filter((function(t,e){return e%n==0||e==r}))},p=0;p<t.length;p++)f(p);return t}();for(var a=[],s=0;s<i.length;s++){var l=g(o.unit_id,i[s]).coordinates;if(!(l.length<r)){var d=o.parseCoordinates(l);a.push(d)}}return a},this.parseCoordinates=function(t){for(var e=new z("path"),r=0;r<t.length;r++){var n=t[r],i=new Z.A(n[0]),o=new Z.A(n[1]),a=i.times(tt).div(et).toNumber(),s=o.times(tt).div(nt).toNumber(),l=i.times(tt).dp(0).toString()+"p"+o.times(tt).dp(0).toString();e.pushPosIds(l),e.pushCoordinateId(l,a,s)}return e},this.edit_data=t,this.gis_info=e,this.layer_uuid=r,this.unit_id=n,this.unit_type=i};const dt=lt;var ht=function(t,e,r,n,i){var o=this;this.generatePath=function(){var t=o.edit_data.layers[o.layer_uuid],e="ok"==t.layer_infomation.path_join,r=Number(t.layer_infomation.threshold),n=Number(t.layer_infomation.thinoout),i=_(o.unit_id,{lake:t.layer_infomation.lake});if(e)return function(){for(var t=[],e=0;e<i.length;e++)for(var a=g(o.unit_id,i[e]),s=o.parseCoordinates(a.coordinates),l=s.pos_order.length,d=0;d<=t.length;d++){if(d>=t.length-1){t.push(s);break}if(t[d].pos_order.length<=l){t.splice(d,0,s);break}}for(var h=function(){for(var e=0,r=0;r<t.length;){for(var n=r+1;n<t.length;){var i=t[r],o=t[n];if(i.getLastNodeId()==o.getFirstNodeId());else if(i.getLastNodeId()==o.getLastNodeId())o.reversePosOrder();else if(i.getFirstNodeId()==o.getFirstNodeId())i.reversePosOrder();else{if(i.getFirstNodeId()!=o.getLastNodeId()){n++;continue}i.reversePosOrder(),o.reversePosOrder()}i.includePathOrder(o,0),t[r]=i,t.splice(n,1),e++}r++}return e},u=h();u>0;)u=h();for(var c=0;c<t.length;)t[c].pos_order.length<r?t.splice(c,1):c++;if(n>0)for(var f=function(e){var r=t[e].pos_order.length-1;t[e].pos_order=t[e].pos_order.filter((function(t,e){return e%n==0||e==r}))},p=0;p<t.length;p++)f(p);return t}();for(var a=[],s=0;s<i.length;s++){var l=g(o.unit_id,i[s]).coordinates;if(!(l.length<r)){var d=o.parseCoordinates(l);a.push(d)}}return a},this.parseCoordinates=function(t){for(var e=new z("path"),r=0;r<t.length;r++){var n=t[r],i=new Z.A(n[0]),o=new Z.A(n[1]),a=i.times(tt).div(et).toNumber(),s=o.times(tt).div(nt).toNumber(),l=i.times(tt).dp(0).toString()+"p"+o.times(tt).dp(0).toString();e.pushPosIds(l),e.pushCoordinateId(l,a,s)}return e},this.edit_data=t,this.gis_info=e,this.layer_uuid=r,this.unit_id=n,this.unit_type=i};const ut=ht;const ct=function(){var t=this;this.pushNode=function(e){return t.svg_tree.push(e),t.svg_tree.length-1},this.pushChild=function(e,r){t.svg_tree[e].linkChild(r)},this.svg_tree=[]};var ft=function(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a},pt=function(t,e,r){if(r||2===arguments.length)for(var n,i=0,o=e.length;i<o;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))},gt=function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},_t=function(t,e){var r=this;this.parser=function(){for(var t=r.edit_data.layers_order,e=0;e<t.length;e++)r.parserLayer(t[e])},this.getLayerName=function(t){var e=r.edit_data.layers[t],n=e.unit_id;switch(r.gis_info.id_type[n]){case"RailroadSection":return"鉄道_"+e.layer_infomation.railway+"_"+e.layer_infomation.line;case"Station":return"駅_"+e.layer_infomation.railway+"_"+e.layer_infomation.line;case"Coast":return"海岸線_"+e.layer_infomation.pref;case"Lake":return"湖_"+e.layer_infomation.lake}return"不明"},this.parserLayer=function(t){var e,n=r.edit_data.layers[t].unit_id,i=(r.gis_info.id_type[n],r.switchParserLayer(t));r.graph_coordinate_dict[r.getLayerName(t)]?(e=r.graph_coordinate_dict[r.getLayerName(t)]).push.apply(e,pt([],ft(i),!1)):r.graph_coordinate_dict[r.getLayerName(t)]=i},this.toSVGPoint=function(t,e){for(var n=e.pos_order,i=e.coordinates,o=0;o<n.length;o++){var a=i.get(n[o]),s=new v;s.setTag("circle"),s.pushAttributeNum("cx",a.x),s.pushAttributeNum("cy",a.y),s.pushAttributeNum("r",4),s.pushAttribute("stroke","none"),s.pushAttribute("stroke-width","0"),s.pushAttribute("fill","black");var l=r.svg_kit.pushNode(s);r.svg_kit.pushChild(0,l),t.linkChild(l)}},this.toSVGPath=function(t,e){var n=e.pos_order,i=new v,o=e.coordinates;i.pushComment(String(e.coordinate_expression_id)),i.setTag("path");var a="rgb("+String(p(50,200))+","+String(p(50,200))+","+String(p(50,200))+")";i.pushAttribute("stroke",a),i.pushAttribute("stroke-width","2"),i.pushAttribute("fill","none");var s=o.get(n[0]);i.pushSvgCommand("M",s.x,s.y);for(var l=0;l<n.length;l++){var d=o.get(n[l]);i.pushSvgCommand("L",d.x,d.y)}var h=r.svg_kit.pushNode(i);t.linkChild(h)},this.toSVG=function(){for(var t=Object.keys(r.graph_coordinate_dict),e=0;e<t.length;e++){var n=t[e],i=r.graph_coordinate_dict[n],o=new v;o.setTag("g"),o.pushAttribute("id",n);var a=r.svg_kit.pushNode(o);r.svg_kit.pushChild(0,a);for(var s=0;s<i.length;s++){var l=i[s];l.coordinates,0!=l.pos_order.length&&("path"==l.getType()&&r.toSVGPath(o,l),"point"==l.getType()&&r.toSVGPoint(o,l))}}return r.svg_kit.svg_tree[0].generate(r.svg_kit.svg_tree)},this.scaling=function(){var t=r.searchCoordinateLeftTop(),e=r.searchCoordinateRightBottom();r.moveCoordinateOrigin(t);var n={x:e.x-t.x,y:e.y-t.y},i=(0,Z.A)(r.edit_data.width).div((0,Z.A)(n.x)).toNumber(),o=(0,Z.A)(r.edit_data.height).div((0,Z.A)(n.y)).toNumber(),a=Math.min(i,o);r.moveCoordinateReduction(a),r.invertedCoordinate(),r.moveCoordinateOrigin(r.searchCoordinateLeftTop()),r.decimalPlaceRound()},this.decimalPlaceRound=function(){for(var t,e,n=Object.values(r.graph_coordinate_dict).flat(),i=0;i<n.length;i++){var o=n[i],a=o.coordinates;o.pos_order;try{for(var s=(t=void 0,gt(a.values())),l=s.next();!l.done;l=s.next()){var d=l.value;d.x=(0,Z.A)(d.x).dp(r.edit_data.decimal_place).toNumber(),d.y=(0,Z.A)(d.y).dp(r.edit_data.decimal_place).toNumber()}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}}},this.invertedCoordinate=function(){for(var t,e,n=Object.values(r.graph_coordinate_dict).flat(),i=0;i<n.length;i++){var o=n[i],a=o.coordinates;o.pos_order;try{for(var s=(t=void 0,gt(a.values())),l=s.next();!l.done;l=s.next()){var d=l.value;d.y=(0,Z.A)(r.edit_data.height).minus((0,Z.A)(d.y)).toNumber()}}catch(e){t={error:e}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}}},this.moveCoordinateReduction=function(t){for(var e,n,i=Object.values(r.graph_coordinate_dict).flat(),o=0;o<i.length;o++){var a=i[o],s=a.coordinates;a.pos_order;try{for(var l=(e=void 0,gt(s.values())),d=l.next();!d.done;d=l.next()){var h=d.value;h.x=(0,Z.A)(h.x).times((0,Z.A)(t)).toNumber(),h.y=(0,Z.A)(h.y).times((0,Z.A)(t)).toNumber()}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}}},this.moveCoordinateOrigin=function(t){for(var e,n,i=Object.values(r.graph_coordinate_dict).flat(),o=0;o<i.length;o++){var a=i[o],s=a.coordinates;a.pos_order;try{for(var l=(e=void 0,gt(s.values())),d=l.next();!d.done;d=l.next()){var h=d.value;h.x=h.x-t.x,h.y=h.y-t.y}}catch(t){e={error:t}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(e)throw e.error}}}},this.searchCoordinateLeftTop=function(){for(var t,e,n=Number.MAX_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,o=Object.values(r.graph_coordinate_dict).flat(),a=0;a<o.length;a++){var s=o[a],l=s.coordinates;s.pos_order;try{for(var d=(t=void 0,gt(l.values())),h=d.next();!h.done;h=d.next()){var u=h.value;n>u.x&&(n=u.x),i>u.y&&(i=u.y)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(e=d.return)&&e.call(d)}finally{if(t)throw t.error}}}return{x:n,y:i}},this.searchCoordinateRightBottom=function(){for(var t,e,n=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=Object.values(r.graph_coordinate_dict).flat(),a=0;a<o.length;a++){var s=o[a],l=s.coordinates;s.pos_order;try{for(var d=(t=void 0,gt(l.values())),h=d.next();!h.done;h=d.next()){var u=h.value;n<u.x&&(n=u.x),i<u.y&&(i=u.y)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(e=d.return)&&e.call(d)}finally{if(t)throw t.error}}}return{x:n,y:i}},this.switchParserLayer=function(t){var e=r.edit_data.layers[t].unit_id,n=r.gis_info.id_type[e];switch(n){case"RailroadSection":return(o=new ot(r.edit_data,r.gis_info,t,e,n)).coordinateAggregation(),o.generatePath();case"Station":var i=new st(r.edit_data,r.gis_info,t,e,n);return i.coordinateAggregation(),i.generatePoint();case"Coast":return(o=new dt(r.edit_data,r.gis_info,t,e,n)).generatePath();case"Lake":var o;return(o=new ut(r.edit_data,r.gis_info,t,e,n)).generatePath()}},this.edit_data=t,this.gis_info=e,this.svg_kit=new ct,this.graph_coordinate_dict={};var n=new v;n.setTag("svg"),n.pushAttribute("xmlns","http://www.w3.org/2000/svg"),n.pushAttributeNum("width",t.width),n.pushAttributeNum("height",t.height),this.svg_kit.pushNode(n)};const vt=_t;self.addEventListener("message",(function(t){var e=new vt(t.data.edit_data,t.data.gis_info);e.parser(),e.scaling();var r=e.toSVG();self.postMessage(r)}),!1)},981:(t,e,r)=>{t.exports=r.p+"c00dd90de7f74c086f0f.json"},446:(t,e,r)=>{t.exports=r.p+"b9c1eca8c513ba63d187.json"},443:(t,e,r)=>{t.exports=r.p+"8017a71150cef563bb8a.json"},53:(t,e,r)=>{t.exports=r.p+"00ac9d3c78b7eb8c5fbf.json"},316:(t,e,r)=>{t.exports=r.p+"7ef746bfe1dfaabf738e.json"},466:(t,e,r)=>{t.exports=r.p+"1586cf2f0328f7658802.json"},975:(t,e,r)=>{t.exports=r.p+"dd577fe92edf12aaad65.json"},185:(t,e,r)=>{t.exports=r.p+"e86153937e4287fff25a.json"}},n={};function i(t){var e=n[t];if(void 0!==e)return e.exports;var o=n[t]={id:t,loaded:!1,exports:{}};return r[t].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.m=r,i.x=()=>{var t=i.O(void 0,[188],(()=>i(628)));return t=i.O(t)},t=[],i.O=(e,r,n,o)=>{if(!r){var a=1/0;for(h=0;h<t.length;h++){for(var[r,n,o]=t[h],s=!0,l=0;l<r.length;l++)(!1&o||a>=o)&&Object.keys(i.O).every((t=>i.O[t](r[l])))?r.splice(l--,1):(s=!1,o<a&&(a=o));if(s){t.splice(h--,1);var d=n();void 0!==d&&(e=d)}}return e}o=o||0;for(var h=t.length;h>0&&t[h-1][2]>o;h--)t[h]=t[h-1];t[h]=[r,n,o]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.f={},i.e=t=>Promise.all(Object.keys(i.f).reduce(((e,r)=>(i.f[r](t,e),e)),[])),i.u=t=>t+".js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;i.g.importScripts&&(t=i.g.location+"");var e=i.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=t})(),(()=>{var t={628:1};i.f.i=(e,r)=>{t[e]||importScripts(i.p+i.u(e))};var e=self.webpackChunkmy_webpack_project=self.webpackChunkmy_webpack_project||[],r=e.push.bind(e);e.push=e=>{var[n,o,a]=e;for(var s in o)i.o(o,s)&&(i.m[s]=o[s]);for(a&&a(i);n.length;)t[n.pop()]=1;r(e)}})(),e=i.x,i.x=()=>i.e(188).then(e);i.x()})();